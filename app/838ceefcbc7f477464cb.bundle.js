"use strict";(self.webpackChunkgameflip_market=self.webpackChunkgameflip_market||[]).push([[8584],{78584:(e,t,a)=>{a.r(t),a.d(t,{default:()=>d});var i=a(67294),n=a(84766),s=a(42741),o=a(46858),r=a(55933),l=a(1055),c=a(78314),m=a(96655);class d extends i.PureComponent{constructor(e,t){super(e,t),this.state={items:r.Z.notifications},this._onChange=this._onChange.bind(this),this._onProfileChange=this._onProfileChange.bind(this)}componentDidMount(){o.Z.checkLogin(!0)&&(r.Z.onChange(this._onChange),c.Z.onChange(this._onProfileChange),o.Z.setDocumentTitle((0,l._)("Notifications")),this.load((()=>{s.Z.getProfile("me",(e=>{c.Z.profile=e}),(e=>{}))})))}componentWillUnmount(){r.Z.offChange(this._onChange),c.Z.offChange(this._onProfileChange)}_onChange(){this.setState({items:r.Z.notifications})}_onProfileChange(){this.load()}load(e){c.Z.isLoggedIn&&r.Z.fetch(e)}render(){if(!o.Z.isLoggedIn)return!1;let e=this.state.items||[];c.Z.profile.email||e.unshift({text:(0,l._)("Email address is missing or not yet confirmed for your account. Please add and confirm your email address."),ref_type:m.emx,ref_id:"/settings/account",created:new Date});let t=e.map(((e,t)=>i.createElement(h,{item:e,key:e.created})));0==t.length&&r.Z.lastFetched>0&&(t=i.createElement("h4",{className:"text-center row empty_message"},(0,l._)("No New Notifications")));let a=(new Date).getTime(),s=t.length>0&&a%2==0?i.createElement("div",{className:"pager alert alert-info text-center",role:"alert"},i.createElement("span",{className:"fa fa-info-circle","aria-hidden":"true"}),"Â ",i.createElement("span",null,(0,l._)("Want instant notification? Install our mobile app and receive notifications in real time!"))):"";return i.createElement("div",{id:"notifications",className:"screen container"},i.createElement("h1",null,(0,l._)("Notifications")," ",i.createElement(n.Link,{to:"settings"},i.createElement("span",{className:"fa fa-cog"}))),i.createElement("div",{className:"inner-content"},i.createElement("div",{className:"item-list"},t)),s)}}class h extends i.Component{constructor(e,t){super(e,t),this.state={item:this.props.item}}componentDidUpdate(e,t){try{JSON.stringify(this.props)!==JSON.stringify(e)&&this.setState({item:this.props.item})}catch(e){n.Log.error(e)}}onItemClick(e){e.preventDefault();let t=this.state.item;r.Z.markRead(t.created_timestamp),this.navigateToPage(t)}navigateToPage(e){let t=e.ref_type,a=e.ref_id,i=e.role;switch(n.Log.debug(t,"navigate to ref_type"),n.Log.debug(a,"navigate to ref_id"),t){case m.hqo:case m.C81:"seller"==i?o.Z.transitionTo("exchange_seller/"+a):o.Z.transitionTo("exchange_buyer/"+a);break;case m.sHQ:case m.TSv:this.redeemBonus(t,a);break;case m.gEo:this.doSearch(a);break;case m.tOl:o.Z.transitionTo("item/"+a);break;case m.gXV:o.Z.transitionTo("wallet/usd/balance");break;case m.emx:a&&o.Z.isBrowser&&a&&(0==a.indexOf("http")?window.location=a:o.Z.transitionTo(a));break;case m.JsP:o.Z.transitionTo("wallet/subscriptions");break;case m.JCH:o.Z.transitionTo("messaging");break;default:if(t&&0==t.indexOf("application")){let e=t.replace("application.","");o.Z.transitionTo("wallet/verify/"+e)}}}onDelete(){let e=this.state.item;r.Z.remove(e.created_timestamp),this.setState({item:null})}render(){let e=this.state.item;if(!e)return!1;let t="/img/app/icon_info.png";switch(e.ref_type){case"exchange":t="/img/app/icon_time_money.png";break;case"listing_search":t="/img/app/icon_follows.png";break;case"listing":t="/img/app/icon_comment.png"}let a=o.Z.timePassed(e.created);return i.createElement("div",{className:"notification pointer row no-gutters "+(e.is_read?"read":"unread")},i.createElement("div",{className:"col-3 col-md-1",onClick:this.onItemClick.bind(this)},i.createElement("img",{className:"img-fluid",src:t})),i.createElement("div",{className:"col-7 col-md-8",onClick:this.onItemClick.bind(this)},i.createElement("p",{className:"body"},e.text),i.createElement("p",{className:"date text-muted"},a)),i.createElement("div",{className:"col-2 col-md-3 text-right"},i.createElement("button",{className:"btn btn-outline-secondary",onClick:this.onDelete.bind(this)},i.createElement("span",{className:"fa fa-trash","aria-hidden":"true"}))))}redeemBonus(e,t){let a=e==m.sHQ?(0,l._)("Invite Reward Redeemed"):(0,l._)("Bonus Reward Redeemed"),i=(0,l._)("Bonus credits have been added to your account.");s.Z.redeemBonusReward(t,(e=>{this.onDelete(),o.Z.showDialog({title:a,message:i,ok:{label:(0,l._)("OK"),callback:e=>{o.Z.hideDialog()}}})}),(e=>{n.Log.error(e)}))}doSearch(e){s.Z.getFollowing(e,(e=>{let t=o.Z.getSearchQuery(e,36),a="shop";t.category&&(t.category==m.gav?a="play":t.category==m.Xnt&&(a="service")),o.Z.transitionTo(a,{},t),this.onDelete()}),(e=>{n.Log.error(e)}))}}}}]);