"use strict";(self.webpackChunkgameflip_market=self.webpackChunkgameflip_market||[]).push([[9927],{39927:(e,t,a)=>{a.d(t,{Z:()=>h});var l=a(67294),i=a(46858),s=a(84766),o=a(42741),n=a(47552),r=a(33727),c=a(95835),m=a(91155),d=a(1055),p=a(78314);class h extends l.Component{constructor(e,t){super(e,t),this.state={profile:i.Z.clone(p.Z.profile),pending:null}}componentDidMount(){this.checkVerifyingEmail()}checkVerifyingEmail(){o.Z.getVerifyEmail((e=>{if(s.Log.debug(e,"verifying email"),e&&e.email&&!e.verified){let t=this.props.query||{};this.setState({pending:{email:e.email,code:t.code||null}},(()=>{this.confirmCode()}))}}),(e=>{}))}safeDisplayName(e){return(e?e.replace(/[:\/\.<>]/g,""):"").trim()}handleChangeCode(e){let t=this.state.pending;t&&(t.code=e.target.value.trim(),this.setState({pending:t}))}confirmCode(){let{profile:e,pending:t}=this.state;t&&t.code&&(s.Log.debug(t,"Confirm code"),o.Z.putVerifyEmail(t.code,(t=>{e.email=t.email,this.setState({profile:e,pending:null});let a=p.Z.profile;a.email=t.email,p.Z.profile=a}),(e=>{i.Z.showErrorDialog(e)})))}resendCode(){let e=this.state.pending;o.Z.postVerifyEmail(e.email,(t=>{e.msg=(0,d._)("A new verification code was sent to your email {email}",{email:e.email}),this.setState({pending:e})}),(e=>{i.Z.showErrorDialog(e)}))}patchProfile(e){e&&e.length>0&&o.Z.patchProfile(e,(e=>{s.Log.debug(e,"Updated profile"),p.Z.profile=e,this.setState({profile:e})}),(e=>{i.Z.showErrorDialog(e)}))}save(e,t){let a=[],{profile:l}=this.state,s=p.Z.profile;switch(e){case"display_name":let e=this.safeDisplayName(t);e!=s.display_name&&a.push({op:"replace",path:"/display_name",value:e});break;case"about":t!=s.about&&a.push({op:"replace",path:"/about",value:t});break;case"email":let n=t?t.trim():"";if(!n)break;o.Z.postVerifyEmail(n,(e=>{l.email=n,this.setState({profile:l,pending:{email:e.email}})}),(e=>{i.Z.showErrorDialog(e)}))}this.patchProfile(a)}showPhotoUploadDialog(e){this.setState({photo_type:e}),m.Z.show("profile-photo-dialog")}onUpload(e){s.Log.debug(e,"Patch profile"),p.Z.profile=e,this.setState({profile:e})}onPreview(e,t){let{profile:a}=this.state;a&&("background"==t&&(a.background=e),"avatar"==t&&(a.avatar=e),this.setState({profile:a}))}render(){let{profile:e,pending:t,info:a}=this.state,s=new Date,o="";t&&(o=l.createElement("div",{className:"row"},t.msg?l.createElement("p",{className:"col-12 text-warning"},l.createElement("span",{className:"fa fa-info-circle","aria-hidden":"true"})," ",t.msg):"",l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Pending Email"),e.email?"":l.createElement("p",{className:"text-danger"},"* ",l.createElement("small",null,(0,d._)("Please confirm your email address to proceed.")))),l.createElement("div",{className:"col-12 col-md-6"},l.createElement("p",null,t.email),l.createElement("div",{className:"input-group input-group-sm"},l.createElement("input",{type:"text",className:"form-control",value:t.code||"",name:"code",placeholder:(0,d._)("Verification Code"),onChange:this.handleChangeCode.bind(this)}),l.createElement("div",{className:"input-group-append"},l.createElement("button",{className:"btn btn-primary"+(t.code?"":" disabled"),onClick:this.confirmCode.bind(this)},(0,d._)("Confirm Code")),l.createElement("span",null," "),l.createElement("button",{className:"btn btn-clear",onClick:this.resendCode.bind(this)},(0,d._)("Resend Code")))),l.createElement("small",{className:"text-muted"},(0,d._)("Please enter the verification code to activate this email.")))));let p=!1,h=e.display_name_updated,u=e.display_name_updated_cooldown,g=u?(0,d._)("There is a {time} cool down for changing display name.",{time:u>=1?u+"-"+(0,d._)("day"):Math.round(24*u)+"-"+(0,d._)("hour")}):"";return h&&u&&(h=new Date(new Date(h).getTime()+24*u*60*60*1e3),s<h&&(g=(0,d._)("You can change display name after")+" "+h.toLocaleString(),p=!0)),l.createElement("div",{className:this.props.className||"container-fluid p-3"},l.createElement("div",{className:"row"},l.createElement("h2",{className:"col-12 mb-4"},(0,d._)("Personal Information"))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-6 col-md-3"},(0,d._)("Name")),l.createElement("div",{className:"col-6 col-md-9 form-group"},l.createElement("span",null,e.first_name," ",e.last_name))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-6 col-md-3"},(0,d._)("Phone Number")),l.createElement("div",{className:"col-6 col-md-9 form-group"},l.createElement("div",null,e.phone))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Email")),l.createElement("div",{className:"col-12 col-md-6 form-group"+(e.email?"":" has-error")},l.createElement(n.Z,{mode:"input",value:e.email||"",placeholder:(0,d._)("Email Address"),submit:this.save.bind(this,"email")}),l.createElement("small",{className:"text-muted"},(0,d._)("A verification code will be sent to your new email address.")))),o,l.createElement("div",{className:"row"},l.createElement("h2",{className:"col-12 mb-4"},(0,d._)("Public Profile"))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-6 col-md-3"},(0,d._)("Profile Code")),l.createElement("div",{className:"col-6 col-md-9 form-group font-weight-bold"},e.invite_code)),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Avatar")),l.createElement("div",{id:"profile",className:"col-12 col-md-2 form-group"},l.createElement("div",{className:"avatar-area"},l.createElement(c.Z,{src:i.Z.avatarUrl(e.avatar),alt:e.display_name,className:"profile-avatar center-block img-fluid rounded-circle img-thumbnail",dim:200,aspectRatio:1}),l.createElement("button",{className:"btn btn-default btn-icon add-photo upload-avatar-button",title:(0,d._)("Change avatar"),onClick:this.showPhotoUploadDialog.bind(this,"avatar")},l.createElement("span",{className:"fa fa-camera"}))))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Display As")),l.createElement("div",{className:"col-12 col-md-6 form-group"+(e.display_name?"":" has-error")},l.createElement(n.Z,{mode:p?"text":"input",value:e.display_name||"",placeholder:(0,d._)("Display Name"),submit:this.save.bind(this,"display_name")}),l.createElement("small",{className:"text-muted"},g))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Profile Description")),l.createElement("div",{className:"col-12 col-md-9 form-group"},l.createElement(n.Z,{mode:"input",rows:5,value:e.about||"",placeholder:(0,d._)("Enter Profile Description"),submit:this.save.bind(this,"about")}),l.createElement("small",{className:"text-muted"},(0,d._)("A complete and accurate profile gives you more credibility for potential buyers")))),l.createElement("div",{className:"row"},l.createElement("p",{className:"col-12 text-muted mt-3"},l.createElement("span",{className:"fa fa-info-circle","aria-hidden":"true"})," ",(0,d._)("Languages you can use to communicate with others.")),l.createElement("div",{className:"col-12 col-md-3"},(0,d._)("Languages")),l.createElement("div",{className:"col-12 col-md-9"},l.createElement(r.Z,{profile:e}))),l.createElement(m.Z,{id:"profile-photo-dialog",type:this.state.photo_type,onUpload:this.onUpload.bind(this),onPreview:this.onPreview.bind(this)}))}}},47552:(e,t,a)=>{a.d(t,{Z:()=>i});var l=a(67294);a(1055);class i extends l.Component{constructor(e,t){super(e,t),this.state=this.getState(this.props)}componentDidUpdate(e,t){JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState(this.getState(this.props))}getState(e){let{mode:t,enable:a,value:l,placeholder:i,faicon:s,tag:o}=e;return{mode:t||"text",enable:a,value:l,placeholder:i,faicon:s,tag:o,editing:!1}}onChange(e){this.setState({value:e.target.value})}edit(e){e.preventDefault(),this.setState({editing:!0},(()=>{setTimeout((()=>{let e=$(this.el).find(".editing input:first");1==e.length&&e.focus()}),300)}))}remove(e){e.preventDefault(),this.props.remove()}submit(e){e.preventDefault(),this.setState({editing:!1});let{value:t}=this.state;this.props.submit(t)}cancel(){this.setState(this.getState(this.props))}render(){let{mode:e}=this.state;return"input"==e?this.renderInput():this.renderText()}renderText(){let{enable:e,value:t,placeholder:a,faicon:i,tag:s,editing:o}=this.state;if(!e&&!t)return!1;let n=l.createElement("span",{className:"value"},t||a);return"a"==s&&t&&(n=l.createElement("a",{className:"value",href:t,target:"_blank"},t)),l.createElement("div",{className:"editable-text",ref:e=>this.el=e},o?l.createElement("form",{className:"editing input-group input-group-sm",onSubmit:this.submit.bind(this)},i?l.createElement("span",{className:"input-group-prepend"},l.createElement("span",{className:"fa fa-"+i})):"",l.createElement("input",{className:"form-control",value:t,placeholder:a+"...",onChange:this.onChange.bind(this)}),l.createElement("div",{className:"input-group-append"},l.createElement("button",{className:"btn btn-outline-secondary text-success",onClick:this.submit.bind(this)},l.createElement("span",{className:"fa fa-check"})))):l.createElement("div",{className:"plain"},i?l.createElement("span",{className:"icon fa fa-"+i}):"",n,e?l.createElement("span",{className:"edit-icon fas fa-pen pointer",onClick:this.edit.bind(this)}):""))}renderInput(){let{remove:e,className:t,rows:a}=this.props,{value:i,placeholder:s,editing:o}=this.state;i||(i=""),s||(s="");let n=!!i;return l.createElement("div",{className:"editable-input"+(n?"":" has-error")+(t?" "+t:""),ref:e=>this.el=e},o?l.createElement("form",{className:"editing input-group input-group-sm",onSubmit:this.submit.bind(this)},a&&a>1?l.createElement("textarea",{className:"form-control",rows:a,placeholder:s,value:i,onChange:this.onChange.bind(this)}):l.createElement("input",{className:"form-control",type:"text",placeholder:s,value:i,onChange:this.onChange.bind(this)}),l.createElement("div",{className:"input-group-append"},l.createElement("button",{className:"btn btn-outline-secondary text-success",onClick:this.submit.bind(this)},l.createElement("span",{className:"fa fa-check"})),l.createElement("button",{className:"btn btn-outline-secondary text-danger",onClick:this.cancel.bind(this)},l.createElement("span",{className:"fas fa-times"})))):l.createElement("div",{className:"input-group input-group-sm"},a&&a>1?l.createElement("textarea",{className:"form-control",rows:a,placeholder:s,value:i,onChange:this.edit.bind(this),readOnly:!0}):l.createElement("input",{className:"form-control",type:"text",placeholder:s,value:i,onClick:this.edit.bind(this),readOnly:!0}),l.createElement("div",{className:"input-group-append"},e?l.createElement("button",{className:"btn btn-outline-secondary",onClick:this.remove.bind(this)},l.createElement("span",{className:"fa fa-trash"})):"",l.createElement("button",{className:"btn btn-outline-secondary",onClick:this.edit.bind(this)},l.createElement("span",{className:"fas fa-pen"})))))}}},91155:(e,t,a)=>{a.d(t,{Z:()=>p});var l=a(67294),i=a(88601),s=a(46858),o=a(84766),n=a(42741),r=a(78314),c=a(1055);const m="photo-upload-dialog",d={background:{width:1200,height:450,bytes:524288},avatar:{width:320,height:320,bytes:524288}};class p extends l.Component{getState(){return{upload_disabled:!1,type:null,photo_type:null,file:null,src:null,actual_bytes:null,actual_width:null,actual_height:null,error:null}}constructor(e,t){super(e,t),this.state=this.getState()}componentDidUpdate(e,t){if(this.props.type!==e.type){let e=this.props.type,t=d[e];this.setState({type:e,photo_type:t})}}static show(e,t){$("#"+(e||m)).modal("show")}static close(e){$("#"+(e||m)).modal("hide")}cancel(){let e=this.props.id||m,{onPreview:t}=this.props,{type:a}=this.state;t&&r.Z.profile&&("background"==a&&t(r.Z.profile.background,a),"avatar"==a&&t(r.Z.profile.avatar,a)),this.setState(this.getState()),p.close(e)}onDrop(e,t){o.Log.debug(e,"onDrop: target"),o.Log.debug(t,"onDrop: files");let{photo_type:a}=this.state,l=t[0],i=a.width,n=a.height;s.Z.compressImageAny(l.preview,i,n,i==n?2:0,!0,(e=>{let t=s.Z.dataURItoBlob(e);s.Z.fileToDataURI(t,(e=>{t.preview=e,this.showPreview(t,!0)}))}),(e=>{this.setState({error:e})}))}showPreview(e){let{onPreview:t}=this.props,{type:a,photo_type:l}=this.state;if(!l)return;let i={bytes:l.bytes,no_dialog:!0},o=s.Z.notValidImage(e,i);if(this.setState({error:o}),o)return;let n=document.createElement("img"),r=e.preview;n.onload=()=>{let l=n.naturalWidth||n.width,i=n.naturalHeight||n.height;l>1e4||i>1e4?this.setState({error:{message:`This file ${l}×${i} is over the dimension limit of 10000×10000 pixels.`}}):(t&&t(r,a),this.setState({file:e,src:r,actual_bytes:e.size,actual_width:l,actual_height:i}))},n.src=r}upload(){let{onUpload:e}=this.props,{type:t,file:a}=this.state;a&&(this.setState({upload_disabled:!0}),n.Z.uploadProfilePhoto(t,a,((a,l)=>{o.Log.debug(a,"id"),o.Log.debug(l,"view_url");let i=[{op:"replace",path:"/"+t,value:a}];n.Z.patchProfile(i,(t=>{e&&e(t),this.cancel()}),(e=>{this.setState({error:e,upload_disabled:!1})}))}),(e=>{this.setState({error:e,upload_disabled:!1})})))}getForm(){let{type:e,src:t,actual_bytes:a,actual_width:o,actual_height:n,upload_disabled:r}=this.state,m=r?" disabled":"",p=this.state.error?l.createElement("div",{className:"alert alert-danger"},(0,c._)("Error"),": ",this.state.error.message):"",h="",u="",g=d[e];g&&(h=g.width+"px × "+g.height+"px "+(0,c._)("Recommended"),t||(u=s.Z.formatBytes(g.bytes)+" "+(0,c._)("Max")));let f=t?{backgroundImage:`url(${t})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"}:{},b=a&&o&&n?`${o}×${n} ${s.Z.formatBytes(a)}`:"";return l.createElement("div",{className:"container-fluid form-horizontal"},p,l.createElement("div",{className:"photo-upload-container"},l.createElement("div",{className:"photo-upload-hint"},h),l.createElement(i.Z,{className:"photo-upload-area",onDrop:this.onDrop.bind(this,e),multiple:!1,accept:"image/*"},l.createElement("div",{className:"photo-upload-area-inner pointer",style:f},l.createElement("div",{className:"photo-upload-size"},u))),l.createElement("div",{className:"photo-upload-hint"},b)),l.createElement("div",{className:"row"},l.createElement("button",{className:"btn btn-outline-secondary",onClick:this.cancel.bind(this)},(0,c._)("Cancel")),l.createElement("button",{className:"btn btn-primary float-right"+m,onClick:this.upload.bind(this)},(0,c._)("Upload"))))}render(){let e=this.props.id||m,t=this.props.title||(0,c._)("Photo Upload"),a=this.getForm();return l.createElement(o.Dialog,{id:e,className:"fade",title:t,content:a})}}}}]);