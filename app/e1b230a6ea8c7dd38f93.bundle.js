"use strict";(self.webpackChunkgameflip_market=self.webpackChunkgameflip_market||[]).push([[1231],{40484:(e,t,a)=>{a.d(t,{Z:()=>d});var r=a(67294),s=a(46858),i=(a(84766),a(47675),a(78314)),n=a(1055),o=a(330),l=a(72251),c=a(53539);class d extends r.Component{constructor(e,t){super(e,t);let{gig:a,tier:r}=this.props;this.state={selectedTierId:r||(a.pkg_custom?"custom":"")}}static getDerivedStateFromProps(e,t){return e.tier!==t.selectedTierId?{selectedTierId:e.tier||"tier1"}:null}onClickEdit(e){e.preventDefault(),this.props.onClickAction&&this.props.onClickAction("edit")}onClickBuy(e){this.props.onClickAction&&this.props.onClickAction("buy",e.id,e.offer)}onSelectTier(e){let t=e.id||"";this.props.onClickAction&&this.props.onClickAction(t),this.setState({selectedTierId:t}),"custom"==t&&this.onCustomOffer()}onCustomOffer(){let{gig:e}=this.props;i.Z.isLoggedIn&&i.Z.profile.owner==e.owner&&s.Z.canUseCustomOffer&&c.Z.show()}tierId(e){return e?e.split("_")[1]:e}isPro(){let{gig:e}=this.props,t=s.Z.itemTagsMap(e)._seller_class||"";return t&&(t=t.toLowerCase()),t&&"pro"==t}render(){let{gig:e,nolink:t}=this.props,{selectedTierId:a}=this.state,c=(new Date,i.Z.isLoggedIn&&i.Z.profile.owner==e.owner),d=[],m=o.$6.slice(0);s.Z.canUseCustomOffer&&m.push("pkg_custom"),m.map(((i,o)=>{let m=s.Z.clone(e[i]),p="custom"==this.tierId(i);if(s.Z.isEmpty(m)){if(!c)return;if(!p)return;return void d.push(r.createElement(l.Z,{key:i,tier:{id:"custom",name:(0,n._)("Custom Offer"),description:(0,n._)("Create and manage customized offers for your buyers"),action:(0,n._)("Manage")},onClick:this.onSelectTier.bind(this)}))}m.id=this.tierId(i);let u=m.id==a;d.push(r.createElement(l.Z,{key:i,tier:m,active:u,onClick:c||t?this.onSelectTier.bind(this):this.onClickBuy.bind(this)}))}));let p=!t&&c?r.createElement("div",{className:"lcoach-edit mt-3"},r.createElement("button",{className:"btn btn-primary lcoach-edit-btn",onClick:this.onClickEdit.bind(this)},(0,n._)("Edit"))):"",u=!t&&c&&this.isPro();return d=r.createElement("div",{className:"lcoach-selects "+(t?"info-table":"")},d),r.createElement("div",{className:"lcoach-price-tiers"},r.createElement("span",{className:"gig-label"},(0,n._)("Offers")),d,p,u?r.createElement("div",{className:"p-2"},r.createElement("span",{className:"fa fa-exclamation-triangle text-danger font-weight-bold"},(0,n._)("Warning"),":")," ",r.createElement("span",{className:"text-muted"},(0,n._)("Updating your listing will remove the Pro tag. To keep your Pro tag, do not update or open a ticket after the updates and reapply for your Pro tag."))):"")}}},48021:(e,t,a)=>{a.d(t,{Z:()=>l});var r=a(67294),s=a(84766),i=a(17515),n=a(84454),o=a(1055);class l extends r.Component{constructor(e,t){super(e,t),this.state=this.getStateFromProps(this.props),this._onUpdatedCurrencies=this._onUpdatedCurrencies.bind(this)}getStateFromProps(e){let{currency:t,filter:a}=e,r="",s="";if(a){let e=a.split(":");r=e.length>0?e[0]:"",s=e.length>1?e[1]:""}let i=this.getSupportedCurrencies(r,s),n=o.Z.currencyLocale();return i.includes(t)||(t=i.includes(n)?n:"USD"),{currency:t,currencies:this.getSupportedCurrencies(r,s)}}getSupportedCurrencies(e,t){let a=[];e?"flow"==e&&n.Z.getMethods().forEach((e=>{e.available&&e.flow==t&&e.currencies.forEach((e=>{a.includes(e)||a.push(e)}))})):a=i.Z.supportedCurrencies();let r=[];return a.map((e=>{let t=n.Z.getMethodsByCurrency(e);t&&t.length>0&&r.push(e)})),r}componentDidMount(){i.Z.onChange(this._onUpdatedCurrencies)}componentWillUnmount(){i.Z.offChange(this._onUpdatedCurrencies)}componentDidUpdate(e,t){try{JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState(this.getStateFromProps(this.props))}catch(e){s.Log.error(e)}}_onUpdatedCurrencies(){this.setState(this.getStateFromProps(this.props))}onSelectCurrency(e){let{onSelectCurrency:t}=this.props;t&&(t(e),i.Z.setStoredCurrency(e))}render(){let{currency:e,currencies:t}=this.state,a="";if(t){let s=[];t.map(((t,a)=>{t!=e&&s.push(r.createElement("a",{key:a,className:"dropdown-item pl-2",onClick:this.onSelectCurrency.bind(this,t)},t))})),a=r.createElement("div",{className:"btn-group"},r.createElement("button",{type:"button",className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.createElement("span",{className:"text-primary"},e," ")),r.createElement("div",{className:"dropdown-menu"},s))}return a}}},80660:(e,t,a)=>{a.d(t,{Z:()=>m});var r=a(67294),s=a(64927),i=a(46858),n=(a(84766),a(47675),a(78314)),o=a(1055),l=a(330),c=a(53539),d=a(96655);class m extends r.Component{constructor(e,t){super(e,t);let{gig:a,tier:r}=this.props;this.state={selectedTierId:r||(a.pkg_custom?"custom":"tier1")}}static getDerivedStateFromProps(e,t){return e.tier!==t.selectedTierId?{selectedTierId:e.tier||"tier1"}:null}onClickEdit(e){e.preventDefault(),this.props.onClickAction&&this.props.onClickAction("edit")}onClickBuy(e,t){t.preventDefault(),this.props.onClickAction&&this.props.onClickAction("buy",e.id,e.offer)}onSelectTier(e,t){this.props.onClickAction&&this.props.onClickAction(e),this.setState({selectedTierId:e})}tierName(e){switch(e){case"pkg_tier1":case"tier1":return(0,o._)("BASIC");case"pkg_tier2":case"tier2":return(0,o._)("PLUS");case"pkg_tier3":case"tier3":return(0,o._)("PRO")}return e}tierId(e){return e?e.split("_")[1]:e}onCustomOffer(){i.Z.canUseCustomOffer&&c.Z.show()}render(){let{gig:e,nolink:t}=this.props,{selectedTierId:a}=this.state,c=new Date,m=n.Z.isLoggedIn&&n.Z.profile.owner==e.owner,p=0,u=null,h=[];l.$6.map((t=>{let s=i.Z.clone(e[t]);if(i.Z.isEmpty(s))return!1;s.id=this.tierId(t),p++,u?a==s.id&&(u=s):u=s,h.push(r.createElement("li",{key:s.id,className:"nav-item"},r.createElement("a",{className:"nav-link "+(a==s.id?"active":""),style:{fontWeight:700,fontSize:"140%"},onClick:this.onSelectTier.bind(this,s.id)},this.tierName(s.id))))})),i.Z.canUseCustomOffer&&(!m&&e.pkg_custom?("custom"==a&&(u=e.pkg_custom,u.id="custom"),h.push(r.createElement("li",{key:"customOffer",className:"nav-item"},r.createElement("a",{className:"nav-link "+("custom"==a?"active":""),style:{fontWeight:700,fontSize:"140%"},onClick:this.onSelectTier.bind(this,"custom")},(0,o._)("CUSTOM"))))):m&&"onsale"==e.status&&h.push(r.createElement("li",{key:"customOffer",className:"nav-item"},r.createElement("a",{className:"nav-link",style:{fontWeight:700,fontSize:"140%"},onClick:this.onCustomOffer.bind(this)},"+",(0,o._)("CUSTOM")))));let g=!t&&m?r.createElement("button",{className:"btn btn-primary gig-edit-btn",onClick:this.onClickEdit.bind(this)},(0,o._)("Edit")):"",y=t||m||e.status!=d.IB?"":r.createElement("button",{className:"btn btn-primary gig-buy-btn",onClick:this.onClickBuy.bind(this,u)},(0,o._)("Buy")),f=!1,_=!1,E="";return i.Z.canUseCustomOffer&&!m&&e.pkg_custom&&(f=u.claimed,_=u.expiration&&c>new Date(u.expiration),y&&(f||_)&&(y=r.createElement("button",{className:"btn btn-primary gig-buy-btn disabled"},f?(0,o._)("Claimed"):(0,o._)("Expired"))),u.expiration&&(E=r.createElement("div",{className:"col-12"},(0,o._)("Offer Expiration"),": ",new Date(u.expiration).toLocaleString()))),!!u&&r.createElement("div",{className:"gig-price-tiers"},r.createElement("div",{className:"row no-gutters info-table",style:{marginBottom:"20px"}},r.createElement("div",{className:"container-fluid"},p>1||i.Z.canUseCustomOffer&&(m||e.pkg_custom)?r.createElement("ul",{className:"nav nav-tabs",style:{marginTop:"20px"}},h):"",r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 d-flex align-items-center"},r.createElement("div",{className:"gig-label mr-auto p-2"},u.name),r.createElement(s.Z,{className:"gig-label formatted-money",money:u.price||0})),r.createElement("div",{className:"col-12"},r.createElement("span",{className:"fa fa-time"}),"  ",r.createElement("span",{className:"text-muted"},1==u.deliver_within_days?(0,o._)("1 day delivery"):(0,o._)("{day} days delivery",{day:u.deliver_within_days})))),r.createElement("div",{className:"row",style:{borderBottom:"none"}},E,r.createElement("div",{className:"col-12 gig-tier-description"},i.Z.replaceLineBreak(u.description.trim()))),g||y?r.createElement("div",{className:"row",style:{borderBottom:"none"}},r.createElement("div",{className:"col-12 text-center"},y||g)):"")))}}},96637:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(67294),s=a(46858);class i extends r.Component{render(){let e=void 0===this.props.use_div||this.props.use_div,t=this.props.items.map(((t,a)=>t?r.createElement(n,{key:a,item:t,use_div:e}):"")),a=(e?"container-fluid info-table border ":"table table-bordered info-table ")+(this.props.className||"");return e?r.createElement("div",{className:a},t):r.createElement("table",{className:a},r.createElement("tbody",null,t))}}class n extends r.Component{componentDidMount(){if(s.Z.isBrowser){let e=$('[data-toggle="popover"]');e.length>0&&e.popover()}}render(){let{item:e,use_div:t}=this.props,a="";if(e.headerprops){switch(e.headerprops.transform){case"lowercase":a+=" text-lowercase";break;case"uppercase":a+=" text-uppercase";break;case"capitalize":a+=" text-capitalize"}switch(e.headerprops.align){case"left":a+=" text-left";break;case"right":a+=" text-right"}}let s="";if(e.contentprops){switch(e.contentprops.transform){case"lowercase":s+=" text-lowercase";break;case"uppercase":s+=" text-uppercase";break;case"capitalize":s+=" text-capitalize"}switch(e.contentprops.align){case"left":s+=" text-left";break;case"right":s+=" text-right"}}e.contentprops&&e.contentprops.size&&!isNaN(e.contentprops.size)&&e.contentprops.size<12&&e.contentprops.size>0?(a+=" col-md-"+(12-e.contentprops.size),s+=" col-md-"+e.contentprops.size):(a+=" col-md-5",s+=" col-md-7");let i=[];if(e.contentprops&&e.contentprops.icon){let t={maxHeight:"2em"};(Array.isArray(e.contentprops.icon)?e.contentprops.icon:[e.contentprops.icon]).map(((a,s)=>{i.push(r.createElement("img",{key:s,style:t,src:e.contentprops.icon}))}))}return t?r.createElement("div",{className:"row "+(e.className||"")},r.createElement("div",{className:"col-6 font-weight-bold"+a},e.header),r.createElement("div",{className:"col-6"+s},e.content," ",i.length>0?i:"")):r.createElement("tr",null,r.createElement("th",{className:"col-6"+a},e.header),r.createElement("td",{className:"col-6"+s},e.content," ",i))}}const o=i},64927:(e,t,a)=>{a.d(t,{Z:()=>u});var r=a(4942),s=a(67294),i=a(50743),n=a.n(i),o=a(44431),l=a.n(o),c=a(17515),d=a(96655);function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){(0,r.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class u extends s.Component{render(){let{money:e,currency:t,rate:a,flpAsUSD:r=!0}=this.props;if(void 0!==e&&t==d.jtz)return r?s.createElement(g,this.props):s.createElement(h,this.props);let i=c.Z.getCurrency(t);return t&&t!=d.qBs&&t!=d.QV0&&i&&"fiat"!=i.type?s.createElement(f,this.props):s.createElement(y,this.props)}}const h=e=>{let{money:t,currency:a,rate:r}=e,i=c.Z.convertFromUSD(t,a,r),n=p({},e);return n.money=i,n.decimals=2,s.createElement(f,n)},g=e=>{let t=p({},e);return t.currency=d.qBs,s.createElement(y,t)},y=e=>{let{money:t,currency:a,rate:r,leadingText:i,trailingText:o,subunit2Unit:l,className:m,moneyClassName:p,currencyClassName:u,schema:h}=e;a&&a!=d.QV0||(a=d.qBs);let g=c.Z.getLocalizedFormat(a);if(a!=d.qBs){void 0!==i&&null!=i||(i="≈ ");let e=c.Z.convertFromUSD(t,a,r);isNaN(e)||e==t||(t=e)}l||(l=100),i=i?s.createElement("span",null,i):"",o=o?s.createElement("span",null,o):"";let y=n().formatMoney(1*t/l,g),f=h?s.createElement("span",{className:p||"money",itemProp:"price",content:y},y):s.createElement("span",{className:p||"money"},y),_=h?s.createElement("span",{className:u||"text-muted",itemProp:"priceCurrency",content:a}," ",a):s.createElement("span",{className:u||"text-muted"}," ",a);return s.createElement("span",{className:m||"formatted-money"},i,f,_,o)},f=e=>{let{money:t,currency:a,rate:r,leadingText:i,trailingText:n,className:o,moneyClassName:m,currencyClassName:p,decimals:u}=e;if(!t)return"";let h=isNaN(u)?a==d.Zp_?2:4:u,g=c.Z.getCurrency(a),y=g?g.subunit_to_unit:"1.0e+"+(a==d.Zp_?6:18),f="bigint"==typeof t||"object"==typeof t,_="string"==typeof t,E=f?t:l()(t);if(f||_||(E=E.times("1.0e+15")),isNaN(E))return s.createElement("span",null);i=i?s.createElement("span",null,i):"",n=n?s.createElement("span",null,n):"";let v=E.div(y).toFixed(h);return s.createElement("span",{className:o||"formatted-money"},i,s.createElement("span",{className:m||"money"},v),s.createElement("span",{className:p||"text-muted"}," ",a),n)}},53414:(e,t,a)=>{a.d(t,{Z:()=>n});var r=a(67294),s=(a(46858),a(84766),a(1055));class i extends r.Component{render(){let{className:e,online_until:t,hideOffline:a,noText:i}=this.props;if(!t)return null;let n=new Date<new Date(t),o=n?(0,s._)("Online"):(0,s._)("Offline"),l=n?"online":"offline";return a&&!n?null:r.createElement("div",{className:"presence-badge "+(e||"")},r.createElement("span",{className:l+(i?"":" presence-indicator")},r.createElement("i",{className:"presence-dot fas fa-circle"})," ",i?"":o))}}const n=i},21397:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(67294),s=a(84766),i=a(46858),n=(a(1055),a(95835));class o extends r.Component{constructor(e,t){super(e,t)}coverMedia(e){let t=null;if("object"==typeof e){if(!t&&e.cover_media&&e.media){let a=e.media[e.cover_media];s.Log.debug(a,"Has cover media"),a&&(t=a)}if(!t&&e.cover_photo&&e.photo){let a=e.photo[e.cover_photo];s.Log.debug(a,"Has cover photo"),a&&(t=a)}}return t}pickFirstMedia(e,t){let a=[e.media,e.photo],r=[],s=null;if(a.map(((e,t)=>{if(e)for(let t in e){let a=e[t];"active"==a.status&&r.push(a)}})),r.length>0){r=i.Z.sortArrayBy(r,"display_order",1);let e=null,a=null;for(let t=0;t<r.length;t++){let s=r[t];if(!e&&s.mime_type&&/^video\//.test(s.mime_type)?e=s:a||s.mime_type&&!/^image\//.test(s.mime_type)||(a=s),e||a)break}s="video"==t?e||a:a||e}return s}isVideo(e){return e&&(/^video\//.test(e)||/^application\/vnd.apple.mpegurl/.test(e))}render(){let{item:e,show:t,placeholder:a,className:i,alt:n,dim:o,aspectRatio:d,autoPlay:m,urlOnly:p}=this.props;if(!e)return r.createElement("div",null);let u=null,h=this.coverMedia(e);return h&&(s.Log.debug(h,"Cover media"),(t&&"video"==t&&h.mime_type&&this.isVideo(h.mime_type)||!h.mime_type||h.mime_type&&this.isVideo(h.mime_type)&&"video"!==t)&&(u=h)),u||(h=this.pickFirstMedia(e,t||"photo"),s.Log.debug(h,"First available media"),t&&"video"==t&&h&&h.mime_type&&this.isVideo(h.mime_type),u=h),p?u?u.view_url:"/img/app/default_blank_photo.png":u?r.createElement(l,{className:i,media:u,alt:n,dim:o,aspectRatio:d||0,autoPlay:m}):r.createElement(c,{className:i,media:{mime_type:"image/png",view_url:a||"/img/app/default_blank_photo.png"},aspectRatio:d||0})}}const l=e=>{let{show:t,media:a}=e;return a.mime_type&&/^video\//.test(a.mime_type)?r.createElement(d,e):a.mime_type&&/^application\/vnd.apple.mpegurl/.test(a.mime_type)?void(content=r.createElement(m,e)):!a.mime_type||a.mime_type&&/^image\//.test(a.mime_type)?r.createElement(c,e):(s.Log.error(a,"Unknown media mime type"),!1)},c=e=>{let{media:t,className:a,name:s,dim:i,aspectRatio:o}=e;return r.createElement(n.Z,{onContextMenu:e=>{if(e)return e.preventDefault()},className:a||"img-fluid",src:t.view_url,alt:s||"",dim:i,aspectRatio:o||0})};class d extends r.Component{constructor(e){super(e),this.state={loaded:!1,paused:!1===e.autoPlay},this.onPlaying=this.onPlaying.bind(this),this.onPause=this.onPause.bind(this)}componentWillUnmount(){this.thisVideo&&(this.thisVideo.onplaying=null,this.thisVideo.onpause=null,this.thisVideo=null)}hasAudio(e){try{return e.mozHasAudio||Boolean(e.webkitAudioDecodedByteCount)||Boolean(e.audioTracks&&e.audioTracks.length)}catch(e){s.Log.debug(e)}}onClickAudio(e){e&&e.preventDefault(),this.thisVideo&&(this.thisVideo.muted=!this.thisVideo.muted,this.forceUpdate())}onPause(e){e&&e.preventDefault(),this.setState({paused:!0})}onPlaying(e){e&&e.preventDefault(),this.setState({paused:!1})}onClickPlayPause(e){if(e&&e.preventDefault(),this.thisVideo){this.thisVideo.paused||this.thisVideo.ended?this.thisVideo.play():this.thisVideo.pause();let e=this.thisVideo.paused||this.thisVideo.ended;this.setState({paused:e})}}onContextMenu(e){if(e)return e.preventDefault()}onLoadedData(e){this.setState({loaded:!0,paused:this.thisVideo&&(this.thisVideo.paused||this.thisVideo.ended)})}render(){let{media:e,className:t,name:a,autoPlay:s}=this.props,{loaded:i,paused:n}=this.state;void 0===s&&(s=!0);let o=i&&this.hasAudio?r.createElement("div",{className:"nftc-token-video-button "+(this.thisVideo&&!this.thisVideo.muted?"fas fa-volume-up":"fas fa-volume-off"),onClick:this.onClickAudio.bind(this)}):null,l=i?r.createElement("div",{className:"nftc-token-video-button "+(n?"fas fa-play":"fas fa-pause"),onClick:this.onClickPlayPause.bind(this)}):null;return r.createElement("div",{className:"nftc-token-video"},r.createElement("div",{className:"nftc-token-video-buttons"},l,o),r.createElement("video",{className:t||"img-fluid",onLoadedData:this.onLoadedData.bind(this),ref:e=>{this.thisVideo=e,e&&(this.thisVideo.onplaying=this.onPlaying,this.thisVideo.onpause=this.onPause)},onContextMenu:this.onContextMenu.bind(this),key:e.view_url,autoPlay:s,loop:!0,muted:!0,playsInline:!0,controls:!1,controlsList:"nodownload"},r.createElement("source",{src:e.view_url,type:e.mime_type})))}}const m=e=>{let{media:t,className:a,name:s,autoPlay:i}=e,n="";t.poster_selected&&t.posters&&t.posters[t.poster_selected]["640x640"]&&(n=t.posters&&t.posters[t.poster_selected]["640x640"].view_url);let o=n?r.createElement("img",{className:"video-player-poster center-block",itemProp:"image",src:n}):"";return r.createElement("div",{className:a||"img-fluid pointer"},o)}},26395:(e,t,a)=>{a.r(t),a.d(t,{default:()=>P});var r=a(67294),s=a(44431),i=a.n(s),n=a(47675),o=a(84766),l=a(42741),c=(a(58166),a(35255)),d=a(46858),m=a(90226),p=a(64927),u=a(95835),h=a(48282),g=a(36314),y=a(96637),f=a(21397),_=a(82928),E=a(48021),v=a(78314),b=(a(40872),a(17515)),N=a(53953),k=a(27721),x=a(1055),Z=a(80660),S=a(40484),C=a(96655);const w=5e5;class P extends r.Component{constructor(e,t){if(super(e,t),this.state=this.getState(),d.Z.isLoggedIn){let e=this.props.match.params;this.searchHeldExchanges((()=>{this.loadListing(e)}))}}getState(){let{tier:e,offer:t}=this.props.match.params;return{item:{id:""},quote:{},tier:"custom"==e?t?"custom":"tier1":e||"tier1",quote_tiers:{},digitalTOS:!1,steam_id:v.Z.steam_id,tradeURL:v.Z.steam_trade_url,deliver_to:"",eth_address:"",deliverArray:new Array(10),order:{},payment:{type:"",source:null,source_id:"",address_id:"",address:null},coupon:"",offer:"custom"==e&&t?t:"",currency:b.Z.getStoredCurrency()}}componentDidMount(){b.Z.update();let e=n.Z.isProduction?"https://ws.bluesnap.com":"https://sandbox.bluesnap.com";this.state.bluesnap_ready||o.ScriptLoader.load(this,e+"/web-sdk/4/bluesnap.js")}onScriptLoaded(e){o.Log.debug("Script loaded: "+e);let t=n.Z.isProduction?"https://ws.bluesnap.com":"https://sandbox.bluesnap.com";e.startsWith(t)&&this.setState({bluesnap_ready:!0})}onScriptError(e){o.Log.debug("Script load error: "+e)}componentDidUpdate(e,t){try{if(JSON.stringify(this.props)!==JSON.stringify(e)){if(!d.Z.isLoggedIn)return;this.setState(this.getState());let e=this.props.match.params;this.loadListing(e)}}catch(e){o.Log.error(e)}}loadListing(e){let t={id:e.id||e.name};"custom"==e.tier&&e.offer&&(t.offer=e.offer),l.Z.getListing(t,(e=>{!d.Z.isLoggedIn||e&&e.status!=C.IB?d.Z.transitionTo("item",{name:d.Z.slug(e.name),id:e.id}):(this.setState({item:e}),this.buyerQuote(this.state.payment),this.loadProduct(e),c.ZP.track(c.Rr,e))}),(e=>{this.setState({item:{}})}))}searchHeldExchanges(e){l.Z.searchExchanges(C._Kh,{limit:5,hold_status:"hold_buy,hold_challenge",sort:"created:desc"},((t,a)=>{let r=(t.exchanges||[]).filter((e=>e.status==C.WWs&&e.hold_status&&[C.Ev_,C.lpQ].includes(e.hold_status)));this.setState({exchanges_held:r},e)}),(t=>{this.setState({exchanges_held:null},e)}))}loadProduct(e){e.upc&&l.Z.getProduct(e.upc,(t=>{o.Log.debug(t,"product"),e.product=t,this.setState({item:e})}),(e=>{}))}updateOrder(e){if(!e)return;let t={price:e.cost.price,shipping_fee:e.cost.shipping_fee,processing_fee:e.cost.processing_fee,discount:e.cost.discount||0,total:e.total_cost,applied_flp_credit:"0"!=e.pay.bonus_flp_amount?e.pay.bonus_flp_amount:"",applied_cash:e.pay.cash_amount+(e.pay.gbux_amount||0),applied_credit:e.pay.bonus_amount,flp_rate:e.flp_rate,mustpay:e.pay.charge_amount};if(t.use_addfund=t.mustpay>0&&(t.mustpay<500||t.mustpay>w),"0"!=e.pay.flp_amount||"0"!=e.pay.gflp_amount){let a=new(i())(e.pay.flp_amount).plus(e.pay.gflp_amount);a.isZero()||(t.applied_flp=a.toString())}o.Log.debug(t,"Quoted order "),this.setState({order:t})}buyerQuote(e){let t=this.state.currency,a=e.type,r=e.provider;this.charge_method=a;let{item:s,tier:i,offer:n}=this.state;if(!s||!s.id)return;let c={charge_method:a,charge_provider:r},m=this.state.coupon||"";m&&(c.coupon=m),n&&(c.offer=n),t&&(c.charge_currency=t),e.source_id&&(c.charge_source_id=e.source_id),o.Log.debug(c,"Getting quote with params"),l.Z.getBuyerQuote(s.id,c,(e=>{o.Log.debug(e,"Buyer quote");let t={},a={};s.kind==C.Bxu?(a=e,t=i&&e[i]?e[i]:{}):t=e,this.setState({quote:t,quote_tiers:a}),this.updateOrder(t)}),(e=>{s.accept_currency==C.jtz&&e&&422==e.code?d.Z.showDialog({title:(0,x._)("Insufficient FLP balance"),message:(0,x._)("Please add sufficient FLP to your wallet before making purchase."),ok:{label:(0,x._)("Go to FLP Wallet"),callback:e=>{d.Z.hideDialog(),d.Z.transitionTo("wallet",{tab:"flp"})}}}):401==e.code||404==e.code?(d.Z.showErrorDialog(e),d.Z.transitionTo("item",{name:d.Z.slug(s.name),id:s.id})):(d.Z.showErrorDialog(e),this.setState({coupon:""}),400==e.code&&o.Storage.set(C.V_z,""))}))}addCoupon(e){if(e){let{payment:t}=this.state;this.setState({coupon:e},(()=>{this.buyerQuote(t)}))}}onChangePayment(e){o.Log.debug(e,"onChangePayment: payment"),this.setState({payment:e}),this.buyerQuote(e)}paymentParams(){let{item:e,payment:t,order:a,currency:r,deliver_to:s,eth_address:i,coupon:n,tier:l,offer:c}=this.state,d={listing_id:e.id};t.source_id&&(d.source_id=t.source_id),t.address?d.address=t.address:t.address_id&&(d.address_id=t.address_id),t.billing_address&&(d.billing_address=t.billing_address);let m=t.source||{};m.provider&&(d.provider=m.provider,d.provider_method=m.type),0==a.mustpay&&(d.source_id=null),r&&(d.charge_currency=r),s?d.deliver_to=s:i&&(d.deliver_to=i),n&&(d.coupon=n),e.kind==C.Bxu&&l&&(d.tier=l,"custom"==l&&(d.offer=c));let p=o.Storage.getObject(C.Ebp)||{};return p.did&&(d.device_data=p.did),o.Log.debug(d,"Payment params"),d}validatePayment(){let{order:e,payment:t}=this.state;if(o.Log.debug(e,"validatePayment: order"),o.Log.debug(t,"validatePayment: payment"),e.use_addfund)return!1;let a=0==e.mustpay||e.mustpay>0&&t.source&&(t.source.id||t.source_id);return o.Log.debug(a,"Validate phase 1"),a=a&&(t.address||t.address_id),o.Log.debug(a,"Validate phase 2"),a}threeDSBluesnap(e){let{order:t,payment:a,currency:r}=this.state,s=this.paymentParams(),i=b.Z.convertWithDecimalPrecision(t.mustpay,r),n={provider:C.rFm,card:a.source||{},amount:i,currency:r};m.Z.runThreeDSForSavedCard(n,(t=>{s.provider=n.provider,s.provider_source={pfToken:t.pfToken},e(s)}),(e=>{o.Log.error(e,"Failed BlueSnap 3DS"),d.Z.showErrorDialog(e.message)}))}placeOrder(e){if(e&&e.preventDefault(),!this.validatePayment()||!this.validateUserInput())return;let{item:t,order:a,payment:r,currency:s,trade_url:i}=this.state,n=this.paymentParams(),m=()=>{n.provider==C.rFm&&n.provider_method==C.XLv?this.threeDSBluesnap(p):p(n)},p=e=>{l.Z.postExchange(e,(e=>{o.Log.debug(e,"Exchange created"),k.Z.setExchange(e),N.Z.getItem(t.id)&&N.Z.removeItem(t),c.ZP.track(c.Il,e),c.ZP.trackPurchase(e,t);let a=e.id;d.Z.transitionTo("exchange_buyer",{id:a})}),(e=>{this.setState({}),d.Z.isSoldError(e)&&(e=(0,x._)("Oops! This listing is no longer on sale."),d.Z.transitionTo("item",{name:d.Z.slug(t.name),id:t.id})),e&&400==e.code&&e.message.includes("Unable to verify address")&&(e=e.message+" "+(0,x._)("Please re-enter the correct address and try again.")),d.Z.showErrorDialog(e)}))},u=this.state.deliverArray.filter((e=>d.Z.notEmpty(e))).join("|");this.setState({deliver_to:u},(()=>{if(!u&&t.category==C.SkU&&i&&i!=v.Z.steam_trade_url){let e=[{op:"replace",path:"/steam_trade_url",value:i}];l.Z.patchProfile(e,(e=>{v.Z.profile=e,m()}),(e=>{d.Z.showErrorDialog(e)}))}else m()}))}onDigitalCheck(e){this.setState({digitalTOS:e.target.checked})}onTradeURL(e){this.setState({tradeURL:e.target.value.trim()})}onETHAddress(e){this.setState({eth_address:e.target.value.trim()})}onDeliverTo(e,t){let a=t.target.value;if("string"==typeof a){let t=this.state.deliverArray;e<t.length&&(t[e]=a.replace(/\|/g,""),this.setState({deliverArray:t}))}}validTradeURL(e){return 0===e.indexOf("https://steamcommunity.com/tradeoffer")}validWalletAddress(e){if(!e)return!1;let t="ronin:",a=e.startsWith("0x")?"0x":e.startsWith(t)?t:"";if(o.Log.debug(a,"Detect address prefix"),!a)return!1;let r=e.replace(a,"").trim();return/[0-9a-fA-F]{40}$/.test(r)}skipDigitalAck(){return(v.Z.profile.buy||0)>=10}requireTradeURL(){let{item:e}=this.state,t=d.Z.gameInfo(e.upc);return e.digital&&e.category==C.SkU&&t.steam_app_id}requireDeliverTo(){let{item:e}=this.state,t=d.Z.gameInfo(e.upc);return e.kind==C.Bxu||e.digital_deliverable==C.tFI&&e.category==C.SkU&&!t.steam_app_id||e.digital_deliverable==C.tFI&&e.category==C.xmu&&!this.requireETHAddress()}requireETHAddress(){let{item:e}=this.state;return e.nft||e.category==C.xmu&&["axie"].includes(e.platform)}validateUserInput(){let{item:e,digitalTOS:t,deliverArray:a,eth_address:r}=this.state,s=!(e.digital&&!this.skipDigitalAck())||t;return!s||e.category!=C.SkU&&e.category!=C.xmu&&e.kind!=C.Bxu||(this.requireTradeURL()?s=this.state.tradeURL&&this.validTradeURL(this.state.tradeURL):this.requireETHAddress()?s=r&&this.validWalletAddress(r):this.requireDeliverTo()&&(s=a.join("").length>0)),s}onSelectTier(e){let{item:t,quote_tiers:a}=this.state;this.setState({tier:e}),this.updateOrder(a[e]),d.Z.replaceState("checkout",{id:t.id,tier:e})}onChangeCurrency(e){b.Z.supportedPaymentProviders(e)&&this.setState({currency:e},(()=>{this.buyerQuote(this.state.payment)}))}render(){if(!d.Z.isLoggedIn)return d.Z.transitionTo(""),!1;let e=this.state.item,t=this.state.order;return v.Z.isLoggedIn&&(v.Z.profile.owner,e.owner),e&&t&&e.status==C.IB?this.renderItem(e):(e&&e.id,!1)}renderItem(e){let{currency:t,order:a,tier:s,eth_address:i,exchanges_held:n}=this.state,o=e.digital&&!this.skipDigitalAck()?r.createElement("div",{className:"row no-gutters"},r.createElement("div",{className:"checkbox"},r.createElement("label",null,r.createElement("input",{type:"checkbox",name:"digital-check",onClick:this.onDigitalCheck.bind(this)}),(0,x._)("I understand all requirements & restrictions associated with this digital item and that digital sales are non-refundable.")))):"",l=this.requireTradeURL()?r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("h2",null,(0,x._)("Steam Trade URL")),r.createElement("div",{className:"form-group"},r.createElement("p",null,(0,x._)("Seller needs your Steam Trade URL to deliver the item."),r.createElement("br",null),r.createElement("a",{href:"http://steamcommunity.com/profiles/"+this.state.steam_id+"/tradeoffers/privacy#trade_offer_access_url",target:"_blank",className:"trade-url-tooltip",title:(0,x._)("Find Trade URL in Steam")},r.createElement("b",null,r.createElement("u",null,(0,x._)("Click here"))))," ",(0,x._)("to find your Trade URL in Steam."),r.createElement("br",null),(0,x._)("In Steam, navigating to"),": ",r.createElement("u",null,(0,x._)("Profile"))," > ",r.createElement("u",null,(0,x._)("Inventory"))," > ",r.createElement("u",null,(0,x._)("Trade Offers"))," > ",(0,x._)("<u>Who can send me Trade Offers</u> and copy the link under <b>Third-Party Sites</b> section",{__html:!0})),r.createElement("input",{type:"text",className:"form-control",id:"tradeURL",value:this.state.tradeURL,onChange:this.onTradeURL.bind(this),placeholder:(0,x._)("Your Trade URL")}),this.state.tradeURL&&!this.validTradeURL(this.state.tradeURL)?r.createElement("small",{className:"text-danger"},(0,x._)("Invalid Trade URL")):"")):"",c="";if(this.requireDeliverTo()){let t=d.Z.deliverToLabels(e),a=[];for(let e=0;e<t.length;e++)a.push(r.createElement("input",{key:e,type:"text",className:"form-control",onChange:this.onDeliverTo.bind(this,e),placeholder:t[e],style:{marginBottom:"4px"}}));c=r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("div",{className:"form-group"},r.createElement("h2",null,e.kind==C.Bxu?(0,x._)("Online Contact"):(0,x._)("Deliver To")),r.createElement("p",null,e.kind==C.Bxu?(0,x._)("Seller needs your Discord contact information for the live session."):(0,x._)("Seller needs your username information to deliver the item."),r.createElement("br",null)),a))}else this.requireETHAddress()&&(c=r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("h2",null,(0,x._)("Wallet Address")),r.createElement("div",{className:"form-group"},r.createElement("p",null,(0,x._)("Please provide your Wallet Address where we will transfer the item to.")),r.createElement("p",{className:"text-warning"},(0,x._)("* Warning: You must use a wallet that can support this NFT.")),r.createElement("input",{type:"text",className:"form-control",id:"eth_address",value:i,onChange:this.onETHAddress.bind(this),placeholder:(0,x._)("Your Wallet Address")}),i&&!this.validWalletAddress(i)?r.createElement("small",{className:"text-danger"},(0,x._)("Invalid Wallet Address")):"")));let m=n&&n.length>0,p=!m&&this.validatePayment()&&this.validateUserInput()?"":" disabled";return r.createElement("div",{id:"checkout",className:"screen container-lg"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 col-md-12"},r.createElement("h1",null,(0,x._)("Checkout")))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 col-md-6"},r.createElement(U,{listing:e}),e.kind==C.Bxu?"pro_play"==e.platform?r.createElement(S.Z,{gig:e,onClickAction:this.onSelectTier.bind(this),nolink:!0,tier:s}):r.createElement(Z.Z,{gig:e,onClickAction:this.onSelectTier.bind(this),nolink:!0,tier:s}):""),r.createElement("div",{className:"col-12 col-md-6 info-table"},r.createElement(T,{currency:t,order:a,item:e,tier:s,onAddCoupon:this.addCoupon.bind(this),onChangeCurrency:this.onChangeCurrency.bind(this)}),m?"":r.createElement(D,{currency:t,order:a}),m?"":r.createElement(A,{currency:t,item:e,order:a,onChangePayment:this.onChangePayment.bind(this)}),m?r.createElement(L,{exchange:n[0]}):"",l,c,m?"":o,r.createElement("div",{className:"row no-gutters border-none"},r.createElement("button",{className:"col-12 btn btn-primary order-button"+p,value:"order",onClick:this.placeOrder.bind(this)},r.createElement("h1",null,(0,x._)("Place Your Order")))),r.createElement("div",{className:"row no-gutters border-none"},r.createElement("div",{className:"col-12 text-center"},r.createElement("p",{className:"text-muted small"},r.createElement("i",{className:"fas fa-lock text-success mr-1"})," ",(0,x._)("Gameflip is SSL Certified. Your information is encrypted and secure.")),r.createElement("p",{className:"text-muted small"},(0,x._)("Your purchase is covered by the {guarantee}.<br />Get the item as described or your money back.",{__html:!0,guarantee:r.createElement("a",{href:"https://gameflip.zendesk.com/hc/en-us/articles/205357318",target:"_blank"},"Gameflip Guarantee")})))))))}}class L extends r.Component{render(){let{exchange:e}=this.props;if(!e.hold_status||-1===[C.Ev_,C.lpQ].indexOf(e.hold_status))return!1;let t=d.Z.clone(e);return t.cover_photo=n.Z.apiEndpoint+"listing/"+e.listing_id+"/photo/cover_photo",t.price=e.price?r.createElement(p.Z,{money:e.bn_price||e.price,currency:e.accept_currency}):"",t.created=(0,x._)("Bought")+" "+d.Z.timePassed(e.created),t.link_to="exchange_buyer",t.link_params={id:e.id},t.ribbon="/img/app/icon_ribbon_in-progress.png",t.status_text=t.hold_status==C.Ev_?(0,x._)("Under Review"):(0,x._)("Payment Verification Required"),r.createElement("div",{className:"row item-detail"},r.createElement("p",{className:"col-12 text-danger"},r.createElement("span",{className:"fa fa-exclamation-triangle","aria-hidden":"true"})," ",r.createElement("span",null,(0,x._)("You cannot make this purchase until the issue with the following purchase is resolved."))),r.createElement("div",{className:"col-3 photo"},r.createElement("div",{className:"square-responsive"},r.createElement(o.Link,{to:t.link_to,params:t.link_params},r.createElement(u.Z,{className:"img-fluid bg_3d",src:t.cover_photo,dim:320}),r.createElement("img",{className:"icon-ribbon",src:t.ribbon})))),r.createElement("div",{className:"col-9 info"},r.createElement("div",{className:"row"},r.createElement("h4",{className:"col-12 name"},r.createElement(o.Link,{to:t.link_to,params:t.link_params},t.name))),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 col-md-5"},r.createElement("div",{className:"text-danger"},t.status_text),r.createElement("span",{className:"h5 price"},t.price),r.createElement("div",{className:"d-none d-md-block date text-muted"},t.created)))))}}class T extends r.Component{constructor(e,t){super(e,t),this.state={discount_form:!1,discount_code:""}}componentDidUpdate(e,t){try{JSON.stringify(this.props)!==JSON.stringify(e)&&this.setState({discount_code:""})}catch(e){o.Log.error(e)}}onEnterDiscount(e){let t=e&&e.target&&e.target.value||"";this.setState({discount_code:t})}openDiscountForm(){this.setState({discount_form:!0})}applyDiscount(){let{discount_code:e}=this.state;this.props.onAddCoupon&&this.props.onAddCoupon(e)}selectCurrency(e){this.props.onChangeCurrency&&this.props.onChangeCurrency(e)}render(){let e=d.Z.isMobile,{currency:t,item:a,order:s,tier:i}=this.props,{discount_form:n,discount_code:o}=this.state,l="",c="",m="";d.Z.flpEnabled&&a.digital&&(a.accept_currency==C.jtz||a.accept_currency==C.QV0)&&(l=r.createElement(p.Z,{money:s.price||0,currency:C.jtz,leadingText:"≈ ",rate:s.flp_rate,flpAsUSD:!1}),r.createElement(p.Z,{money:s.processing_fee||0,currency:C.jtz,leadingText:"≈ ",rate:s.flp_rate,flpAsUSD:!1}),m=r.createElement(p.Z,{money:s.total||0,currency:C.jtz,leadingText:"≈ ",rate:s.flp_rate,flpAsUSD:!1}));let u="USD"!=t?r.createElement(p.Z,{money:s.price,currency:t,leadingText:"≈ "}):"",h="USD"!=t?r.createElement(p.Z,{money:s.processing_fee,currency:t,leadingText:"≈ "}):"",g="USD"!=t?r.createElement(p.Z,{money:s.total,currency:t,leadingText:"≈ "}):"",f=[];if(f.push({header:(0,x._)("Currency"),content:r.createElement(E.Z,{filter:"flow:auth-capture",currency:t,onSelectCurrency:this.selectCurrency.bind(this)}),headerprops:{align:"left"},contentprops:{align:"right"}}),a.kind==C.Bxu&&i&&a[`pkg_${i}`]){let e=a[`pkg_${i}`];f.push({header:(0,x._)("Package"),content:r.createElement("div",null,e.name),headerprops:{align:"left"},contentprops:{align:"right"}})}if(f.push({header:(0,x._)("Price"),content:r.createElement("div",null,r.createElement(p.Z,{money:s.price})," ",l," ",r.createElement("div",{className:"small"},u)),headerprops:{align:"left"},contentprops:{align:"right"}}),s.discount){let e="USD"!=t?r.createElement(p.Z,{money:-1*s.discount,currency:t,moneyClassName:"money text-danger"}):"";f.push({header:(0,x._)("Discount"),content:r.createElement("div",null,r.createElement(p.Z,{money:-1*s.discount,moneyClassName:"money text-danger"})," ",r.createElement("div",{className:"small"},e)),headerprops:{align:"left"},contentprops:{align:"right"}})}a.kind!=C.Iox||a.digital||f.push({header:(0,x._)("Shipping"),content:r.createElement(p.Z,{money:s.shipping_fee}),headerprops:{align:"left"},contentprops:{align:"right"}}),"processing_fee"in s&&!isNaN(s.processing_fee)&&f.push({header:r.createElement("span",null,(0,x._)("Processing Fee"),"  ",d.Z.itemInfoPopover("processing_fee")),content:r.createElement("div",null,r.createElement(p.Z,{money:s.processing_fee})," ",r.createElement("div",{className:"small"},h)),headerprops:{align:"left"},contentprops:{align:"right"}}),f.push({header:e?(0,x._)("Total"):(0,x._)("Order Total"),className:"checkout-order-total",content:r.createElement("div",null,r.createElement(p.Z,{money:s.total,className:"formatted-money font-weight-bold"})," ",m," ",r.createElement("div",{className:"small"},g)),headerprops:{align:"left",transform:"uppercase"},contentprops:{align:"right"}});let _=n?r.createElement("div",{className:"mt-2 input-group float-right"},r.createElement("input",{className:"form-control",type:"text",name:"discount",value:o,onChange:this.onEnterDiscount.bind(this),placeholder:(0,x._)("Discount code")}),r.createElement("div",{className:"input-group-append"},r.createElement("button",{className:"btn btn-primary"+(o?"":" disabled"),onClick:this.applyDiscount.bind(this)},(0,x._)("Apply")))):r.createElement("div",{className:"discount form-line float-right"},r.createElement("a",{className:"btn-link",onClick:this.openDiscountForm.bind(this)},(0,x._)("Have discount code?")));return r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("h2",null,(0,x._)("Order")),r.createElement(y.Z,{className:"checkout-order",items:f}),s.discount?"":_)}}class D extends r.Component{render(){let{order:e,currency:t}=this.props,a="USD"!=t?r.createElement(p.Z,{money:e.applied_credit||0,currency:t,leadingText:"≈ "}):"",s="USD"!=t?r.createElement(p.Z,{money:e.applied_cash||0,currency:t,leadingText:"≈ "}):"",i=[];return e.applied_flp_credit&&i.push({header:(0,x._)("Applied FLP credits"),content:r.createElement(p.Z,{money:e.applied_flp_credit,currency:"FLP",rate:1,flpAsUSD:!1}),headerprops:{align:"left"},contentprops:{align:"right"}}),e.applied_flp&&i.push({header:(0,x._)("Applied FLP"),content:r.createElement(p.Z,{money:e.applied_flp,currency:"FLP",rate:1,flpAsUSD:!1}),headerprops:{align:"left"},contentprops:{align:"right"}}),e.applied_credit&&i.push({header:(0,x._)("Applied credits"),content:r.createElement("div",null,r.createElement(p.Z,{money:e.applied_credit})," ",r.createElement("div",{className:"small"},a)),headerprops:{align:"left"},contentprops:{align:"right"}}),i.push({header:(0,x._)("Applied cash balance"),content:r.createElement("div",null,r.createElement(p.Z,{money:e.applied_cash})," ",r.createElement("div",{className:"small"},s)),headerprops:{align:"left"},contentprops:{align:"right"}}),r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("h2",null,(0,x._)("Wallet")),r.createElement(y.Z,{items:i}))}}class U extends r.Component{constructor(e,t){super(e,t),this.state={showListing:!d.Z.isBrowser||!d.Z.isMobile}}onShowListing(){let{showListing:e}=this.state;this.setState({showListing:!e})}render(){let{showListing:e}=this.state,t=d.Z.isMobile,a=this.props.listing,s=a.kind==C.Iox?d.Z.itemInfo(a,{is_compact:t}):"";return r.createElement("div",{className:"mb-3"},r.createElement("div",{className:"row no-gutters"},r.createElement("div",{className:"container-fluid border info-table"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-4 col-md-3 p-0"},r.createElement(f.Z,{alt:a.name,className:"rounded border img-fluid "+(a.category==C.SkU?"bg_3d":"bg_2d"),item:a,dim:320,aspectRatio:1})),r.createElement("div",{className:"col-8 col-md-9 d-flex flex-column align-self-center"},r.createElement("h3",{className:"mt-0"},a.name),r.createElement("div",{className:"text-muted",style:{overflow:"hidden"}},o.Util.cut(a.description,120))))),r.createElement("div",{className:"col-12 mb-1"},r.createElement(_.Z,{as_seller:!0,id:a.owner,is_compact:t}))),s&&t?r.createElement("div",{className:"text-right"},r.createElement("a",{className:"text-primary",onClick:this.onShowListing.bind(this)},(0,x._)("Show")," ",e?(0,x._)("Less"):(0,x._)("More")," ",r.createElement("i",{className:"fas fa-caret-"+(e?"up":"down")}))):null,s&&e?r.createElement("div",{className:"row no-gutters"},r.createElement(y.Z,{className:"checkout-item-info",items:s})):"")}}class A extends r.Component{constructor(e){super(e);let t={type:C.XLv,provider:"",address_id:d.Z.shipToAddressId(),source:null,address:null};"auth-capture"==d.Z.defaultPaymentFlow()&&(t.type=d.Z.defaultPaymentType(),t.provider=d.Z.defaultPaymentProvider()),this.state={payment:t}}componentDidMount(){let e=this.state.payment;this.props.onChangePayment(e)}onPaymentSelect(e,t){o.Log.debug(e,"onPaymentSelect type"),o.Log.debug(t,"onPaymentSelect source");let a=this.state.payment;a.type=e,a.source=t,a.source_id=t&&t.id?t.id:null,a.address=t&&t.address?t.address:null,a.billing_address=t&&t.billing_address?t.billing_address:null,a.address_id=null,o.Log.debug(a,"Payment selected"),this.setState({payment:a},(()=>{this.props.onChangePayment(a)}))}onPaymentSwitch(e,t){let a=this.state.payment;a.provider=t,a.type=e,delete a.source,delete a.source_id,delete a.address,delete a.billing_address,e==C.XLv&&(a.source_id=d.Z.defaultPaymentId(),a.address_id=d.Z.shipToAddressId()),o.Log.debug(a,"onPaymentSwitch payment"),this.setState({payment:a},(()=>{this.props.onChangePayment(a)}))}onAddressSelect(e){let t=this.state.payment;e?t.address_id=e.id:(t.address_id="",t.address=null),this.setState({payment:t},(()=>{this.props.onChangePayment(t)}))}render(){let{order:e,item:t,currency:a}=this.props,s="",i=this.state.payment;e.use_addfund||!i.source&&!i.source_id&&0!=e.mustpay||(s=e.mustpay>0&&i.address?r.createElement("div",{className:"container-fluid info-table"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12"},d.Z.formatAddress(i.address)))):r.createElement(h.Z,{type:C.BPU,address_id:i.address_id,onSelect:this.onAddressSelect.bind(this)}));let n=s?r.createElement("h2",null,t.digital?(0,x._)("Billing Address"):(0,x._)("Shipping Address")):"",l=[{header:(0,x._)("Total charges"),content:r.createElement(p.Z,{money:e.mustpay,currency:a}),headerprops:{align:"left",transform:"uppercase"},contentprops:{align:"right"}}],c="";if(e.use_addfund){let t=e.mustpay>w?(0,x._)("Please add funds to your wallet before purchasing this item."):(0,x._)("Please add sufficient funds to your wallet before making purchase.");c=r.createElement("div",{className:"container-fluid info-table"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 col-md-8"},t),r.createElement("div",{className:"col-12 col-md-4"},r.createElement(o.Link,{className:"btn btn-primary",to:"wallet",params:{tab:"usd",section:"deposit"}},(0,x._)("Add Funds")))))}else e.mustpay>0&&(c=r.createElement(g.Z,{item:t,amount:e.mustpay,type:i.type,source_id:i.source_id,currency:a,onSelect:this.onPaymentSelect.bind(this),onSwitch:this.onPaymentSwitch.bind(this)}));return r.createElement("div",{className:"row no-gutters checkout-section"},r.createElement("h2",null,(0,x._)("Payment")),r.createElement(y.Z,{items:l}),c,n,s)}}},27721:(e,t,a)=>{a.d(t,{Z:()=>i});var r=a(84766),s=(a(46858),a(96655));const i=new class{constructor(){this._exchanges=r.Storage.getObject(s.cL1)||{}}storeExchanges(){r.Storage.setObject(s.cL1,this._exchanges)}get cache_expire(){return(new Date).getTime()+18e4}get exchanges(){return this._exchanges}setExchange(e){e.cache_expire=this.cache_expire,this._exchanges[e.id]=e,this.storeExchanges()}deleteExchange(e){delete this._exchanges[e],this.storeExchanges()}getExchangesByStatus(e){let t=(new Date).getTime(),a=!1,s=[];for(let r in this._exchanges){let i=this._exchanges[r];i.cache_expire<t?(delete this._exchanges[r],a=!0):(!e||e.indexOf(i.status)>=0)&&s.push(i)}return r.Log.debug(s,"IndexingExchangesStore.getExchangesByStatus: exchanges"),a&&this.storeExchanges(),s}getActiveExchanges(){return this.getExchangesByStatus()}}},4942:(e,t,a)=>{function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:()=>r})}}]);