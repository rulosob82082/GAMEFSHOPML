"use strict";(self.webpackChunkgameflip_market=self.webpackChunkgameflip_market||[]).push([[8445],{20771:(e,t,a)=>{a.d(t,{Z:()=>h});var r=a(74927),n=a(20890),s=a(67294),o=a(45697),d=a.n(o),c=(a(73935),a(94184)),i=a.n(c),l=a(84766),m=a(96655);let p=l.countryData.allCountries;class u extends s.Component{constructor(e,t){super(e,t),this.state=this.getState(),this.state.showDropDown=!1,this.flagDropdownRef=s.createRef(),this.countrySelector=[],(0,r.map)(p,((e,t)=>{this.countrySelector[t]=s.createRef()}))}getState(){let e=this.props.country?this.props.country.toLowerCase():"us",t=(0,r.find)(p,{iso2:e});return{selectedCountry:t,selectedCountryIndex:(0,n.findIndex)(p,t)}}componentDidMount(){l.ScriptLoader.load(this,m.gAR,{htmlElem:"link"})}componentDidUpdate(e,t){try{JSON.stringify(this.props)!==JSON.stringify(e)&&this.setState(this.getState())}catch(e){l.Log.error(e)}}onScriptLoaded(e){e==m.gAR&&l.Log.debug(e,"Loaded css")}onScriptError(e){l.Log.error(e,"Error loading css")}scrollTo(e,t){if(!e)return;let a=this.flagDropdownRef.current;if(!a)return;let r=a.offsetHeight,n=a.getBoundingClientRect().top+document.body.scrollTop,s=n+r,o=e,d=o.getBoundingClientRect(),c=o.offsetHeight,i=d.top+document.body.scrollTop,l=i+c,m=i-n+a.scrollTop,p=r/2-c/2;if(i<n)t&&(m-=p),a.scrollTop=m;else if(l>s){t&&(m+=p);let e=r-c;a.scrollTop=m-e}}getElement(e){return this.countrySelector[e]?this.countrySelector[e].current:null}handleFlagDropdownClick(){this.setState({showDropDown:!this.state.showDropDown,selectedCountryIndex:(0,n.findIndex)(p,this.state.selectedCountry)},(()=>{this.state.showDropDown&&this.scrollTo(this.getElement(this.state.selectedCountryIndex),!0)}))}handleFlagItemClick(e){let t=this.state.selectedCountry,a=(0,r.find)(p,e);t.iso2!==a.iso2&&this.setState({showDropDown:!1,selectedCountry:a},(()=>{this.props.onChange&&this.props.onChange(e.iso2)}))}getCountryDropDownList(){let e=(0,r.map)(p,((e,t)=>{let a=i()({country:!0,preferred:"us"===e.iso2||"gb"===e.iso2,active:"us"===e.iso2,highlight:this.state.selectedCountryIndex===t}),r=`flag ${e.iso2}`;return s.createElement("li",{ref:this.countrySelector[t],key:`flag_no_${t}`,"data-flag-key":`flag_no_${t}`,className:a,"data-country-code":e.iso2,onClick:this.handleFlagItemClick.bind(this,e)},s.createElement("div",{className:r}),s.createElement("span",{className:"country-name"},e.name))}),this);const t=s.createElement("li",{key:"dashes",className:"divider"});e.splice(p.length,0,t);const a=i()({"country-list":!0,hide:!this.state.showDropDown});return s.createElement("ul",{ref:this.flagDropdownRef,className:a},e)}render(){let e=i()({arrow:!0,up:this.state.showDropDown}),t=i()({"flag-dropdown":!0,"open-dropdown":this.state.showDropDown}),a=`flag ${this.state.selectedCountry.iso2}`,r=this.getCountryDropDownList();return s.createElement("div",{className:"phone-input country-select"},s.createElement("div",{ref:"flagDropDownButton",className:t},s.createElement("div",{ref:"selectedFlag",onClick:this.handleFlagDropdownClick.bind(this),className:"selected-flag"},s.createElement("div",{className:a},s.createElement("div",{className:"name"},this.state.selectedCountry.name),s.createElement("div",{className:e}))),this.state.showDropDown?r:""))}}u.defaultProps={country:p[222].iso2,flagsImagePath:"./flags.png"},u.propTypes={country:d().string,onChange:d().func};const h=u},58445:(e,t,a)=>{a.d(t,{Z:()=>_});var r=a(67294),n=a(24652),s=a.n(n),o=a(16054),d=a(20771),c=a(84766),i=a(42741),l=a(46858),m=a(90226),p=a(47675),u=a(96655),h=a(17515),g=a(1055),b=a(78314);const f="new-card-form";class y extends r.Component{static cardIconUrl(e){switch(e){case"all":return"/img/app/icon_credit_card_all.jpg";case"master":case"mastercard":case"Mastercard":case"MasterCard":return"/img/app/icon_credit_card_mastercard.png";case"visa":case"Visa":return"/img/app/icon_credit_card_visa.png";case"discover":case"Discover":return"/img/app/icon_credit_card_discover.png";case"amex":case"american-express":case"American Express":return"/img/app/icon_credit_card_amex.png"}return"/img/app/icon_card_placeholder.png"}static card3dsIconUrl(e){switch(e){case"master":case"MasterCard":return"/img/app/icon_card_3ds_mastercard.png";case"visa":case"Visa":return"/img/app/icon_card_3ds_visa.png"}return""}constructor(e,t){super(e,t),this.state={error:null,saving:!1,ingenico_ready:!1,token:{},card:this.emptyCard,first_name:"",last_name:""}}static show(){$("#cardDialog").is(":visible")||$("#cardDialog").modal("show")}static hide(){$("#cardDialog").modal("hide")}get emptyCard(){return{name:"",number:"",exp_month:"",exp_year:"",cvc:"",address_zip:"",address_country:"us"}}componentDidUpdate(e,t){let{card:a}=this.state,r=this.props.payment;if(r&&JSON.stringify(r)!==JSON.stringify(e.payment)){let e=r.first_name,t=r.last_name;e&&t&&(a.name=e+" "+t,this.setState({card:a,first_name:e,last_name:t}))}}componentDidMount(){c.Log.debug("Credit Card: Loading library"),"undefined"==typeof connectsdk?c.ScriptLoader.load(this,u.Bnt):this.setState({ingenico_ready:!0});let e=p.Z.isProduction?"https://ws.bluesnap.com":"https://sandbox.bluesnap.com";this.state.bluesnap_ready||(c.ScriptLoader.load(this,e+"/web-sdk/4/bluesnap.js"),c.ScriptLoader.load(this,e+"/js/cse/v1.0.4/bluesnap.js")),c.ScriptLoader.load(this,u.$Ye,{htmlElem:"link"})}onScriptLoaded(e){c.Log.debug("Credit Card: Script loaded: "+e);let t=p.Z.isProduction?"https://ws.bluesnap.com":"https://sandbox.bluesnap.com";e==u.Bnt?"undefined"==typeof connectsdk?this.setState({error:{message:"Cannot access to Ingenico. Please refresh and try again!"}}):this.setState({ingenico_ready:!0}):e.startsWith(t)&&this.setState({bluesnap_ready:!0})}onScriptError(e){c.Log.debug("Credit Card: Script load error: "+e),e==u.Bnt&&e==u.rxL&&this.setState({error:{message:(0,g._)("Cannot access to {url}. Please refresh and try again!",{url:e})}})}applyMaskToCardNumber(e,t){if(c.Log.warn(t,"Applies custom card mask (NOTE: should not do this)"),"string"!=typeof e)return"";let a=e.split(""),r="";for(let e=0;e<a.length;e++)r+=a[e],(e+1)%4==0&&e+1!==a.length&&(r+=" ");return r}handleChange(e,t){let a=this.state.card||this.emptyCard(),r=t&&"object"==typeof t&&t.target?t.target.value||"":t;"number"==e&&(r=r.replace(/\D/g,"")),a[e]=r,this.setState({card:a,error:null})}validateName(){let{first_name:e,last_name:t}=this.state;return e&&t&&e.trim().length>0&&t.trim().length>0}handleName(e,t){let a=t&&"object"==typeof t&&t.target?t.target.value||"":t;this.setState({[e]:a.substring(0,15)})}onRenaming(){this.setState({renaming:!0})}onRename(){let{card:e,first_name:t,last_name:a}=this.state;this.validateName()&&i.Z.patchPaymentName(t.trim(),a.trim(),(t=>{e.name=t.first_name+" "+t.last_name,this.setState({card:e,renaming:!1,first_name:t.first_name,last_name:t.last_name})}),(e=>{this.setState({error:e,renaming:!1})}))}handleInputFocus(e){let t=e.target.name;"cc-csc"==t&&(t="cvc"),this.setState({focus:t})}validate(e){let t=s().number(e.number),a={card:null,isValid:!1,error:null};t&&t.isValid||(a.error=(0,g._)("Invalid credit card number"));let r=t.card||{},n=s().expirationDate({month:e.exp_month,year:e.exp_year});n&&n.isValid||(a.error=(0,g._)("Invalid expiration month or year"));let o=r.code&&r.code.size?r.code.size:3,d=s().cvv(e.cvc,o);return d&&d.isValid?!e.address_zip||e.address_zip.length<3||e.address_zip.length>15?a.error=(0,g._)("Zip / Postal Code is missing or invalid"):(!e.name||e.name.length<3)&&(a.error=(0,g._)("Missing card holder name")):a.error=(0,g._)("Invalid security code"),a.card=r,a.isValid=Boolean(!a.error),a}saveCardToBluesnap(e,t,a){c.Log.debug("Saving card to Bluesnap");let{amount:r,currency:n}=this.props,{first_name:s,last_name:o}=this.state,d=new BlueSnap(p.Z.isProduction?"10001$a92a7db90897258a93b8a864ff01c4a8807567fa7695a20ef41f45d3e5bb203688d440ccb73f1e782daaf4286c7888d48a12a852d314a0bd5c613dd932dc864a3b80e4914b59030f24af0ae226665fbed11a97eba4d1dcaf03a003f8230e6cc26988b6fe1c11c5d35f7a86591943ce9b39be6fd9ce08b192166e80d1f50ba377b16fad268b02637af804e4de6d08612d816ee7ae3935ab6c6e694a6e492dcebdca5742267be0a07ba7c3c792e4664ef0eaa26482a1920a30a55f7bf6c39fedc7284a316a0ece2684058d0c963f66883611592785e200d44df6a4113df93b58a7450a319393f3e65cee2801bed2ed7c37305b66edcbf0c6ee9824570fcf47d12f":"10001$a7e657bb78b9d1d64b3ee17a2aa55acc426d96d5dd8d7b59bb190ef6253b54c07c3c23640d247856ee191f0bd7ad823258fba00b40b63d8a022f097ea43d9eba658c5f240fd09f7a1be8417ddb9a7d3c8a5ded248640777fb09a19884f6cdbae4b271f143e7c9a7e51c49094bdba79105955ec5e50f1b8a55a9ba3bd4a05ab4ff33fda312153abcbb4563306de639bfb947f1fb94001e8a13347853c6f4acaaf3c1f9444937235c222c02fcddd215b451b5fabbcee3333f9e216f7d21e041df0833ac0d871252bce1fcf8839ae04a89a140d84fa89bfd4e6c7f1b6fd6189f559f1e4412b61539d1ce60b58d73878d5ea1c3e9afde5a1d5ad779cbc2fe6f42375",!p.Z.isProduction);n||(n="USD");let i=h.Z.convertWithDecimalPrecision(r||500,n),l={firstName:s,lastName:o,zip:e.address_zip,country:e.address_country.toUpperCase()},g={last4:e.last4,billingContactInfo:l};e.brand&&(g.brand=e.brand),(()=>{let r={provider:u.rFm,card:e,amount:i,currency:n};m.Z.runThreeDSForNewCard(r,(a=>{g.pfToken=a.pfToken,a.cardData&&(a.cardData.last4Digits&&(g.last4=a.cardData.last4Digits),a.cardData.ccType&&(g.brand=a.cardData.ccType)),a.threeDSecure&&a.threeDSecure.threeDSecureReferenceId&&(g.threeDSecure={threeDSecureReferenceId:a.threeDSecure.threeDSecureReferenceId}),(a=>{let r={cardNumber:e.number,securityCode:e.cvc,expirationMonth:parseInt(e.exp_month),expirationYear:parseInt(e.exp_year)};d.encrypt(f);let n=$("input[name='encryptedCreditCard']");n&&(r.encryptedCardNumber=n.val(),delete r.cardNumber);let s=$("input[name='encryptedCvv']");s&&(r.encryptedSecurityCode=s.val(),delete r.securityCode),a.creditCard=r,e.brand&&!a.brand&&(a.brand=e.brand),t(a)})(g)}),a)})()}saveCardToIngenico(e,t,a){let{amount:r,currency:n}=this.props,s={provider:u.edL,card:e,amount:r,currency:n};m.Z.runThreeDSForNewCard(s,(e=>{t(e.cardData)}),a)}save(e){e.preventDefault();let t=this.props.provider;c.Log.debug(t,"Using card provider");let a=this.state.card,r=this.validate(a),n=r.error||"";if(n)return void this.setState({error:{message:n}});c.Log.debug(r,"validated card"),"discover"==r.card.type&&(t="blue_snap"),this.setState({saving:!0}),a.brand=r.card.niceType||"",a.last4=a.number.slice(-4);let s=(e,t,a)=>{c.Log.debug(t,"Open new window"),window.paymentChargedCallback=t=>{c.Log.debug(t,"Query from window callback");let a=l.Z.parseQuery(t);if(a.RETURNMAC&&a.RETURNMAC==e.returnMac&&a.paymentId){c.Log.debug("3D Secure challenge succeeded");let e=this.state.token;e.payment_id=a.paymentId,delete e.redirect_url,this.setState({token:e},o)}else c.Log.error(a,"3D Secure challenge failed")},c.Log.debug(e.redirectUrl,"Open window"),l.Z.openWindow(e.redirectUrl,t,a)},o=()=>{let e=this.state.token;if(c.Log.debug(e,"Token we are saving"),!t)return void c.Log.error("No provider for saving tokenized card");let r={label:(a.brand?a.brand:"")+"-"+a.last4,provider:t,source:e.source,return_url:e.return_url||null,payment_id:e.payment_id||null};i.Z.postPaymentSource(r,(e=>{e.redirect_url?(c.Log.debug(e,"New credit card received 3DS challenge"),s({redirectUrl:e.redirect_url,returnMac:e.returnmac},(0,g._)("Payment Verification"))):(c.Log.debug(e,"New credit card saved"),this.setState({card:this.emptyCard,saving:!1,token:{}},(()=>{y.hide(),this.props.onSuccess(e)})))}),(e=>{this.setState({error:e,saving:!1,token:{}})}))},d=e=>{c.Log.error(e,"Error saving card to '"+t+"'"),this.setState({error:e,saving:!1})},m=(e,a,r)=>{if(c.Log.debug(a,"Got tokenized card: "+e),!a)return void c.Log.debug("No card token available");c.Log.debug(a,`Setting token state for ${t}`);let n=this.state.token||{};n.source=a,"ingenico"==e&&(n.return_url=`${p.Z.config.server_url}/api/callback/payment/charged`),this.setState({token:n},r)};"ingenico"==t?this.saveCardToIngenico(a,(e=>{m("ingenico",e,o)}),d):"blue_snap"==t?this.saveCardToBluesnap(a,(e=>{m("blue_snap",e,o)}),d):(c.Log.error(t,"No card provider"),this.setState({error:{message:"No card provider",code:404},saving:!1}))}cancel(e){e.preventDefault(),c.Log.debug("New Credit Card canceled"),this.setState({card:this.emptyCard,saving:!1,token:{}},(()=>{y.hide()}))}render(){let{provider:e}=this.props;c.Log.debug(e,"Card provider props");let{card:t,error:a,saving:n,first_name:s,last_name:i,renaming:m}=this.state,p=this.validate(t),u=p.isValid&&!n?"":" disabled",h=a?r.createElement("div",{className:"alert alert-danger"},(0,g._)("Error"),": ",a.message):"",b=(y.cardIconUrl("all"),(new Date).getFullYear()),_=[];for(let e=b;e<b+12;e++)_.push(r.createElement("a",{key:e,className:"dropdown-item pl-2",onClick:this.handleChange.bind(this,"exp_year",e+"")},e));let v=r.createElement("div",{className:"btn-group"},r.createElement("button",{type:"button",className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.createElement("span",null,t.exp_year||"----"," ")),r.createElement("div",{className:"dropdown-menu"},_)),C=[];["","01","02","03","04","05","06","07","08","09","10","11","12"].map(((e,t)=>{C.push(r.createElement("a",{key:t,className:"dropdown-item pl-2",onClick:this.handleChange.bind(this,"exp_month",e)},e))}));let S=r.createElement("div",{className:"btn-group"},r.createElement("button",{type:"button",className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.createElement("span",null,t.exp_month||"--"," ")),r.createElement("div",{className:"dropdown-menu"},C)),w=t.number;if(p.card&&p.card.type&&p.card.gaps){w="";for(let e=0;e<t.number.length;e++)-1!==p.card.gaps.indexOf(e)&&(w+=" "),w+=t.number[e]}t.logo=y.cardIconUrl(p.card.type);let N=r.createElement("input",{type:"tel",placeholder:(0,g._)("Card Number"),className:"form-control",name:"cc-number",autoComplete:"cc-number",value:w,onChange:this.handleChange.bind(this,"number"),onFocus:this.handleInputFocus.bind(this)}),D=r.createElement("input",{type:"tel",placeholder:(0,g._)("Security Code (CVC or CVV)"),className:"form-control",name:"cc-csc",autoComplete:"cc-csc",value:t.cvc,onChange:this.handleChange.bind(this,"cvc"),onFocus:this.handleInputFocus.bind(this)});return"blue_snap"==e&&(N=r.cloneElement(N,{"data-bluesnap":"encryptedCreditCard"}),D=r.cloneElement(D,{"data-bluesnap":"encryptedCvv"})),r.createElement(c.Dialog,{className:"fade",title:(0,g._)("Add New Credit Card"),id:"cardDialog",content:r.createElement("div",{className:"container-fluid",id:f},h,r.createElement(o.Z,{number:t.number,cvc:t.cvc,name:t.name,expiry:(t.exp_month||"••")+t.exp_year,focused:this.state.focus,placeholders:{name:(0,g._)("Card Holder")}}),r.createElement("div",{className:"container-fluid info-table mt-3"},l.Z.isInternal?r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 mt-3 text-danger"},"[Internal Only] Card Provider: ",e)):"",r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 mt-3"},r.createElement("div",{className:"input-group"},t.logo?r.createElement("div",{className:"input-group-prepend"},r.createElement("span",{className:"input-group-text"},r.createElement("img",{style:{maxHeight:"20px"},src:t.logo}))):"",N)),m?r.createElement("div",{className:"col-12 mt-3 input-group"},r.createElement("input",{type:"text",placeholder:(0,g._)("First Name"),className:"form-control",value:s,onChange:this.handleName.bind(this,"first_name"),onFocus:this.handleInputFocus.bind(this)}),r.createElement("input",{type:"text",placeholder:(0,g._)("Last Name"),className:"form-control",value:i,onChange:this.handleName.bind(this,"last_name"),onFocus:this.handleInputFocus.bind(this)}),r.createElement("div",{className:"input-group-append"},r.createElement("button",{className:"btn "+(this.validateName()?"btn-primary":"disabled"),type:"button",onClick:this.onRename.bind(this)},(0,g._)("Update")))):r.createElement("div",{className:"col-12 mt-3 input-group"},r.createElement("input",{type:"text",placeholder:(0,g._)("Card Holder"),className:"form-control",name:"cc-name",autoComplete:"cc-name",value:t.name,onChange:this.handleChange.bind(this,"name"),onFocus:this.handleInputFocus.bind(this)}),r.createElement("div",{className:"input-group-append"},r.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:this.onRenaming.bind(this)},(0,g._)("Change")))),r.createElement("div",{className:"col-12 col-md-6 mt-3"},D),r.createElement("div",{className:"col-6 col-md-3 my-3"},S),r.createElement("div",{className:"col-6 col-md-3 my-3 pl-0"},v)),r.createElement("div",{className:"row"},r.createElement("label",{className:"col-12 col-md-6"},(0,g._)("Billing Zip / Postal Code")),r.createElement("div",{className:"col-12 col-md-6"},r.createElement("input",{type:"text",className:"form-control",name:"postal-code",autoComplete:"postal-code",value:t.address_zip,onChange:this.handleChange.bind(this,"address_zip"),onFocus:this.handleInputFocus.bind(this)}))),r.createElement("div",{className:"row"},r.createElement("label",{className:"col-12 col-md-6"},(0,g._)("Country")),r.createElement("div",{className:"col-12 col-md-6"},r.createElement(d.Z,{country:t.address_country,onChange:this.handleChange.bind(this,"address_country")})))),r.createElement("div",{className:"buttons row text-right"},r.createElement("button",{className:"btn btn-primary"+u,onClick:this.save.bind(this)},(0,g._)("Save")),r.createElement("button",{className:"btn btn-outline-secondary",onClick:this.cancel.bind(this)},(0,g._)("Cancel"))))})}}class _ extends r.Component{constructor(e,t){super(e,t),this.state={cards:{},card_id:l.Z.defaultPaymentId()}}componentDidMount(){this.loadPayment()}loadPayment(){i.Z.getPayment((e=>{let t=e.source||{},{card_id:a}=this.state,{source:r}=this.props;b.Z.card_added=l.Z.notEmpty(t),this.setState({payment:e,cards:t,card_id:a})}),(e=>{}))}addCreditCard(e){let{currency:t}=this.props;g.Z.systemLocale().country,e==u.PS$?this.addCardAuthorizeNet(u.PS$):y.show()}onNewCreditCard(e){this.setState({card_id:e.id},(()=>{this.loadPayment()})),e.use_3ds=this.use3DS(e),e.use_3ds||this.props.onSelect(e)}use3DS(e){return!1}deleteCard(e){l.Z.showDialog({title:(0,g._)("Delete Card"),message:(0,g._)("Do you want to delete this card?"),ok:{label:(0,g._)("Delete"),callback:t=>{i.Z.deleteCard(e,(t=>{l.Z.hideDialog(),e==this.state.card_id&&(this.setState({card_id:null}),this.props.onSelect(null)),this.loadPayment()}),(e=>{l.Z.hideDialog(),l.Z.showErrorDialog(e)}))}},cancel:{label:(0,g._)("Cancel"),callback:e=>{l.Z.hideDialog()}}})}onCardClick(e,t,a){if(!e)return;let r=null,n=this.state.cards;switch(n[e]&&(r=n[e],r.id=e,c.Log.debug(r,"Select card")),t){case"verified":c.Log.debug(a,"Completed card 3DS verification '"+e+"' with new source"),a&&this.props.onSelect(a);break;case"select":c.Log.debug(a,"Select card '"+e+"' with source"),this.setState({card_id:e},(()=>{r.use_3ds=this.use3DS(r),r.use_3ds?this.props.onSelect(null):this.props.onSelect(r)}));break;case"delete":this.deleteCard(e)}}deviceCheck(){let e=(c.Storage.getObject(u.Ebp)||{}).did;if(!e)return"";let t=p.Z.isProduction?"1204222":"779669",a=(p.Z.isProduction?"https://www.bluesnap.com":"https://sandbox.bluesnap.com")+"/servlet/logo.htm?s="+e,n="https://www.bluesnap.com/servlet/logo.gif?s="+e+"&d="+t;return r.createElement("iframe",{width:"1",height:"1",frameBorder:"0",scrolling:"no",src:a},r.createElement("img",{width:"1",height:"1",src:n}))}addCardAuthorizeNet(e){c.Log.debug(e,"Adding card for provider");let t=null,a=`${e}_window`;t=l.Z.openWindow("",a);let r=(a,r,n)=>{c.Log.debug(r,"Open new window"),window.paymentChargedCallback=a=>{i.Z.putPaymentSource(e,(e=>{let t=e.source,{cards:a}=this.state;if(t)for(let e in t){let r=t[e];r.id=e,a[e]||this.onNewCreditCard(r)}}),(e=>{this.setState({error:e})})),t&&t.close()},window.paymentCancelledCallback=e=>{c.Log.debug(e,"User cancelled adding card")},c.Log.debug("Open window using POST"),l.Z.openWindow("",r,n);let s=`<form method="POST" action="${(p.Z.isProduction?"https://accept.authorize.net":"https://test.authorize.net")+"/customer/addPayment"}" target="${r}">`;s+=`<input type="hidden" name="token" value="${a}" />`,s+="</form>",c.Log.debug(s,"Form to be posted!"),$(s).appendTo("body").submit().remove()},n={provider:e,return_url:`${p.Z.config.server_url}/api/callback/payment/charged`};i.Z.postPaymentSource(n,(e=>{c.Log.debug(e,"info for authorize net"),r(e.token,a)}),(e=>{this.setState({error:e,saving:!1,token:{}})}))}render(){let{payment:e,cards:t,card_id:a,provider_internal:n}=this.state,{amount:s,currency:o,item:d,hide_3ds:c,provider:i}=this.props,m="";if(l.Z.isInternal){n&&(i=n);let e=[];[u.rFm,u.PS$].map(((t,a)=>{e.push(r.createElement("a",{key:a,className:"dropdown-item pl-2",onClick:()=>{this.setState({provider_internal:t})}},t))})),m=r.createElement("div",{className:"btn-group"},r.createElement("button",{type:"button",className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},r.createElement("span",{className:"text-primary"},n," ")),r.createElement("div",{className:"dropdown-menu"},e))}let p=i==u.rFm,h=[];if(t)for(let e in t){let a=t[e];a.id=e,h.push(a)}let b=h.map(((e,t)=>{let n=e.id==a;return n&&e.blue_snap_id&&(p=!0),e.use_3ds=this.use3DS(e),r.createElement(v,{key:t,card:e,selected:n,source:n?this.props.source:null,hide_3ds:c,onAction:this.onCardClick.bind(this)})}));return r.createElement("div",{className:"container-fluid info-table"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-12 col-md-4"},r.createElement("button",{className:"btn btn-link",onClick:this.addCreditCard.bind(this,i)},r.createElement("span",{className:"fa fa-chevron-right","aria-hidden":"true"}," "),(0,g._)("Add new card"))),r.createElement("div",{className:"col-12 col-md-8"},m?r.createElement("span",{className:"text-muted align-middle pr-2"},"Provider: "):"",m)),b,p?this.deviceCheck():"",r.createElement(y,{payment:e,provider:i,amount:s,currency:o,onSuccess:this.onNewCreditCard.bind(this)}))}}class v extends r.Component{shouldCardBeRemoved(e){return e&&e.provider&&e.provider==u.edL}onAction(e,t){let{card:a}=this.props;this.shouldCardBeRemoved(a)?l.Z.showDialog({title:(0,g._)("Your Action Required"),message:(0,g._)("For security purpose, please re-enter the card information using 'Add new card'."),ok:{label:(0,g._)("OK"),callback:e=>{l.Z.hideDialog()}}}):this.props.onAction&&this.props.onAction(e,t)}render(){let{card:e,selected:t,hide_3ds:a}=this.props,n=y.cardIconUrl(e.brand);return!a&&t&&e.use_3ds&&(!e.braintree_id||"Visa"!=e.brand&&"MasterCard"!=e.brand?e.stripe_id&&e.three_d_secure&&("required"==e.three_d_secure||"optional"==e.three_d_secure)&&c.Log.error(e,"Stripe 3DS card"):c.Log.error(e,"Braintree 3DS card")),r.createElement("div",{className:"row"},r.createElement("div",{className:"col-1 text-right"},r.createElement("span",{className:"pointer far fa-"+(t?"check-square text-primary":"square"),"aria-hidden":"true",onClick:this.onAction.bind(this,e.id,"select")})),r.createElement("div",{className:"col-3 col-lg-2 pointer",align:"center",onClick:this.onAction.bind(this,e.id,"select")},r.createElement("img",{src:n,className:"img-fluid"}),r.createElement("div",{className:"small text-muted"},(0,g._)(l.Z.capitalize(e.funding)))),r.createElement("div",{className:"col-6 col-lg-7 pointer",onClick:this.onAction.bind(this,e.id,"select")},r.createElement("div",null,r.createElement("strong",null,e.name," (*** ",e.last4,")")),this.shouldCardBeRemoved(e)?r.createElement("small",{className:"text-danger"},(0,g._)("Please re-enter this card information.")):""),r.createElement("div",{className:"col-1"},r.createElement("span",{className:"text-muted fa fa-trash pointer","aria-hidden":"true",onClick:this.onAction.bind(this,e.id,"delete")})),"")}}},90226:(e,t,a)=>{a.d(t,{Z:()=>o}),a(47675);var r=a(84766),n=a(42741),s=(a(46858),a(96655));const o=new class{runThreeDSForNewCard(e,t,a){let{provider:r,card:n,amount:o,currency:d}=e;switch(o||(o=100),d||(d="USD"),r){case s.rFm:let e={amount:o,currency:d,ccNumber:n.number,cvv:n.cvc,expDate:n.exp_month+"/"+n.exp_year};this._execThreeDSecureBlueSnap(e,o,d,t,a);break;case s.edL:this._execThreeDSecureIngenico(n,o,d,t,a)}}runThreeDSForSavedCard(e,t,a){let{provider:n,card:o,amount:d,currency:c}=e;switch(d||(d=100),c||(c="USD"),n){case s.rFm:let e={amount:d,currency:c,last4Digits:o?o.last4:"",ccType:o?(i=o.brand,i?"American Express"==i?"AMEX":i.toUpperCase():""):""};this._execThreeDSecureBlueSnap(e,d,c,t,a);break;case s.edL:r.Log.error("No implementation yet")}var i}_execThreeDSecureBlueSnap(e,t,a,o,d){r.Log.debug(e,"Setup 3DS for BlueSnap"),n.Z.postPaymentToken({provider:s.rFm,provider_method:"pftoken"},(t=>{(t=>{r.Log.debug(t,"Calling threeDsPaymentsSetup with pfToken"),bluesnap.threeDsPaymentsSetup(t,(e=>{if(r.Log.debug(e,"Response from 3DS"),1==e.code){let a=e.cardData,n=e.threeDSecure;r.Log.debug(a,"cardData"),r.Log.debug(n,"3DS result"),o({cardData:a,threeDSecure:n,pfToken:t})}else{r.Log.error(e.info,"Error 3DS");let t="";e.info&&e.info.errors?e.info.errors.map((e=>{t+=e+"; "})):e.status,d&&d({message:t,code:501})}})),bluesnap.threeDsPaymentsSubmitData(e)})(t)}),(e=>{r.Log.error(e,"Fail to start BlueSnap 3DS session"),d&&d(e)}))}_execThreeDSecureIngenico(e,t,a,s,o){r.Log.debug("Saving card to Ingenico");let d=e.number&&e.number.length>6?e.number.substr(0,6):e.number,c={totalAmount:t,countryCode:e.address_country.toUpperCase(),locale:"en_US",isRecurring:!1,currency:a},i=t=>{let a=new connectsdk.MaskingUtil;t.getIinDetails(d,c).then((n=>{if(r.Log.debug(n,"getIinDetails"),"SUPPORTED"!==n.status){let e={message:"Card check error: "+n.status,code:501};return r.Log.error(e),o(e)}let d=e.exp_month+"/"+e.exp_year.slice(-2);t.getPaymentProduct(n.paymentProductId,c).then((n=>{r.Log.debug(n,"Ingenico payment product");let c=n.paymentProductFieldById.cardNumber;r.Log.debug(c.displayHints.mask,"Card mask");let i=a.applyMask(c.displayHints.mask,e.number),l=i?i.formattedValue:this.applyMaskToCardNumber(e.number,mask),m=t.getPaymentRequest();if(m.setPaymentProduct(n),m.setValue("cardNumber",l),m.setValue("cardholderName",e.name),m.setValue("cvv",e.cvc),m.setValue("expiryDate",d),!m.isValid()){r.Log.error("Payment request not valid");for(let e in m.getErrorMessageIds())r.Log.debug(e,"Payment request not valid");for(let e=0;e<n.paymentProductFields.length;e++){let t=n.paymentProductFields[e];t.dataRestrictions.isRequired&&(m.getValue(t.id)||m.getAccountOnFile()||r.Log.error(t.id,"Missing field"))}}t.getEncryptor().encrypt(m).then((t=>{r.Log.debug("Encrypted to: "+t);let a={last4:e.last4,cardholder_name:e.name,exp_month:parseInt(e.exp_month),exp_year:parseInt(e.exp_year),encrypted_customer_input:t,address_zip:e.address_zip,country:e.address_country.toUpperCase()};s({cardData:a})}),(e=>{r.Log.error(e,"Failed to encrypt payment request"),o(e)}))}),(e=>{r.Log.error(e,"Failed to get payment product"),o(e)}))}),(e=>{r.Log.error(e,"Failed getIinDetails()"),o(e)}))};n.Z.postPaymentSession("ingenico",(e=>{r.Log.debug(e,"GFApi.postPaymentSession");let t=new connectsdk.Session({clientSessionId:e.clientSessionId,customerId:e.customerId,clientApiUrl:e.clientApiUrl,assetUrl:e.assetUrl});r.Log.debug(t,"Ingenico Session"),i(t)}),(e=>{r.Log.error(e,"Fail to start Ingenico 3DS session"),o&&o(e)}))}}}}]);