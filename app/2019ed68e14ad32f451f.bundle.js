"use strict";(self.webpackChunkgameflip_market=self.webpackChunkgameflip_market||[]).push([[6578],{50238:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(67294),a=s(84766),l=s(42741),r=s(46858),n=s(35255),o=s(78314),c=s(1055);class d extends i.Component{getState(){return{owner:null,comments:[],next:null}}constructor(e,t){super(e,t),this.state=this.getState()}componentDidMount(){this.loadData(this.props)}componentDidUpdate(e,t){JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState(this.getState(),(()=>{this.loadData(this.props)}))}loadData(e){let{id:t,owner_id:s}=e;this.loadComments(t),this.loadOwnerProfile(s)}refreshComments(){this.loadComments(this.props.id)}loadOwnerProfile(e){e&&l.Z.getProfile(e,(e=>{this.setState({owner:e})}),(e=>{}))}loadComments(e){e&&l.Z.getListingComments({listingId:e},(e=>{e.list&&e.list.length>0&&e.list.sort(((e,t)=>e.created>t.created?1:-1)),this.setState({comments:e.list,next:e.next})}),(e=>{}))}loadMoreComments(){this.state.next&&l.Z.getListingComments({url:this.state.next},(e=>{e.list&&e.list.length>0&&e.list.sort(((e,t)=>e.created>t.created?1:-1));let t=e.list.concat(this.state.comments);this.setState({comments:t,next:e.next})}),(e=>{}))}render(){let{id:e,status:t,className:s}=this.props,{next:a,comments:l,owner:r}=this.state,n="";l&&l.length>0&&(n=l.map(((e,t)=>i.createElement(h,{key:t,comment:e,owner:r}))));let o=a?i.createElement("div",{className:"row no-gutters"},i.createElement("p",{className:"btn btn-link",onClick:this.loadMoreComments.bind(this)},(0,c._)("View older comments"))):"",d="sold"==t?"":i.createElement(m,{id:e,owner:r?r.owner:null,onCommentPosted:this.refreshComments.bind(this)}),u=s||"container-fluid";return i.createElement("div",{className:u},o,n,d)}}class h extends i.Component{render(){let{comment:e,owner:t}=this.props,s=r.Z.timePassed(e.created),l=r.Z.avatarUrl(e.avatar),n=t&&t.owner==e.owner,o=a.Util.compareAlphaNumeric(e.display_name,"Gameflip")?"G***flip":e.display_name,d=t&&t.owner!=e.owner&&a.Util.compareAlphaNumeric(t.display_name,e.display_name);return i.createElement("div",{className:"row item-comment no-gutters"},i.createElement("div",{className:"avatar col-3 col-md-2"},i.createElement(a.Link,{to:"profile",params:{id:e.owner,name:r.Z.slug(e.display_name)}},i.createElement("img",{src:l,alt:o,className:"img-fluid rounded-circle img-thumbnail"}))),i.createElement("div",{className:"col-9 col-md-10"},i.createElement("div",{className:"row no-gutters"},i.createElement("span",{className:"col-6"},i.createElement("b",null,o)),n?i.createElement("small",{className:"col-6 text-right text-primary"},(0,c._)("Owner")," ",i.createElement("span",{className:"fa fa-user","aria-hidden":"true"})):"",d?i.createElement("small",{className:"col-6 text-right text-danger"},(0,c._)("Not Owner")," ",i.createElement("span",{className:"fa fa-warning-sign","aria-hidden":"true"})):""),i.createElement("div",null,i.createElement("p",null,e.comment),i.createElement("p",{className:"text-muted"},s))))}}class m extends i.Component{constructor(e,t){super(e,t),this.state={comment:"",owner:this.props.owner,isLoggedIn:o.Z.isLoggedIn,isVerified:o.Z.isVerified,isIDVerified:o.Z.isIDVerified},this._onUserChange=this._onUserChange.bind(this)}componentDidUpdate(e,t){JSON.stringify(e)!==JSON.stringify(this.props)&&this.setState({owner:this.props.owner})}componentDidMount(){o.Z.onChange(this._onUserChange)}componentWillUnmount(){o.Z.offChange(this._onUserChange)}_onUserChange(){this.state.isLoggedIn!=o.Z.isLoggedIn&&this.setState({isLoggedIn:o.Z.isLoggedIn}),this.state.isVerified!=o.Z.isVerified&&this.setState({isVerified:o.Z.isVerified}),this.state.isIDVerified!=o.Z.isIDVerified&&this.setState({isIDVerified:o.Z.isIDVerified})}onTypeComment(e){let t="";e.target.value&&(t=e.target.value.length>512?e.target.value.substr(0,512):e.target.value),this.setState({comment:t})}onKeyPressed(e){let t=e.target.value.substr(0,512),s=e.keyCode;t.length>0&&13==s&&this.postComment()}postComment(){this.state.comment&&l.Z.postListingComment(this.props.id,this.state.comment,(e=>{n.ZP.track(n.yB),this.setState({comment:""}),this.props.onCommentPosted&&this.props.onCommentPosted()}),(e=>{let t=e.message||"An unknown issue has occured";r.Z.showErrorDialog("Error: "+t,"Cannot Post Comment")}))}openSignin(){o.Z.openSignin()}render(){let{isLoggedIn:e,isVerified:t,isIDVerified:s}=this.state;if(o.Z.profile&&o.Z.profile.owner,e&&t)return i.createElement("div",{className:"row no-gutters input-group input-group-sm"},i.createElement("input",{type:"text",className:"form-control",placeholder:(0,c._)("Write a comment"),value:this.state.comment,onChange:this.onTypeComment.bind(this),onKeyDown:this.onKeyPressed.bind(this)}),i.createElement("div",{className:"input-group-append"},i.createElement("button",{className:"btn btn-outline-secondary",onClick:this.postComment.bind(this)},(0,c._)("Send"))));{let t=e?(0,c._)("Verify your phone to comment"):(0,c._)("Login to comment");return i.createElement("div",{className:"row no-gutters"},i.createElement("p",{className:"btn btn-link",onClick:this.openSignin.bind(this)},t))}}}},46578:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var i=s(67294),a=s(84766),l=s(47675),r=s(42741),n=s(46858),o=s(36230),c=s(50238),d=s(40654),h=s(48282),m=s(21397),u=s(59969),p=s(64927),g=s(49280),_=s(74685),b=s(68091),f=s(25315),E=s(16778),v=s(96655);const k="progress";class w extends a.EventHandler{constructor(){super(),this.reset()}reset(){this._items=[],this._accept_currency="",this._current=0,this._total=0,this._success=0,this._failure=0,this._failed_items=[],this._error=""}emitProgress(){this.emit(k)}onProgress(e){this.on(k,e)}offProgress(e){this.off(k,e)}set items(e){this._items=e,this.total=e.length}get items(){return this._items}set accept_currency(e){this._accept_currency=e}get accept_currency(){return this._accept_currency}set total(e){this._total=e,this.emitProgress()}get total(){return this._total}increaseSuccess(){this._success++,this.emitProgress()}get success(){return this._success}increaseFailure(e){e&&this._failed_items.push(n.Z.clone(e)),this._failure++,this.emitProgress()}get failure(){return this._failure}get failed_items(){return this._failed_items}get error(){return this._error}get in_progress(){return this._current>0}openDialog(){this.emitChange()}execute(){if(this._current>=this._total)return;let e=this._items[this._current];this._current++,e.digital?this.patch(e):(this._error="Accept currencies for some listings below could not be changed.",this.increaseFailure(e),this.execute())}patch(e){let t=this._accept_currency,s=(t,s,i)=>{let l=[{op:"replace",path:"/status",value:t}];r.Z.patchListing(e.id,l,(e=>{E.Z.setItem(e),s&&s(e)}),(e=>{a.Log.error(e,"BulkSwitchCurrencyDialog: _executePatchStatus: error"),i&&i(e)}))},i=s=>{let i=[{op:"replace",path:"/accept_currency",value:t}];r.Z.patchListing(e.id,i,(e=>{E.Z.setItem(e),this.increaseSuccess(),this.execute(),s&&s(e)}),(e=>{a.Log.error(e,"BulkSwitchCurrencyDialog: _executePatchAcceptCurrency: error"),this.increaseFailure(),this.execute(),s&&s()}))};e.status==v.IB?s(v.f1I,(e=>{i((e=>{s(v.IB)}))}),(e=>{this.increaseFailure(),this.execute()})):i()}}const y=new w;var x=s(1055);class Z extends i.Component{getState(){return{accept_currency:v.QV0,currencies:{[v.qBs]:!0,[v.jtz]:!0},total:0,success:0,failure:0}}constructor(e,t){super(e,t),this.state=this.getState(),this._onChange=this._onChange.bind(this),this._onProgress=this._onProgress.bind(this),this.should_show=!1,this.should_close=!1}componentDidMount(){y.onChange(this._onChange),y.onProgress(this._onProgress)}componentDidUpdate(){this.should_show?(this.should_show=!1,this.show()):this.should_close&&(this.should_close=!1,setTimeout((()=>{this.hide();let e=n.Z.pagingQuery(this.props.query||{},50);n.Z.transitionTo("listings",{tab:this.props.tab},e);let t=y.error,s=y.failed_items;if(t){let e=n.Z.notEmpty(s)?i.createElement(b.Z,{items:s,nolink:!0,view:"list"}):"",a=i.createElement("div",null,i.createElement("div",{className:"alert alert-danger"},t),e);setTimeout((()=>{n.Z.showDialog({title:"There is an error",message:a,ok:{label:"OK",callback:e=>{n.Z.hideDialog()}}})}),1e3)}y.reset()}),1e3))}componentWillUnmount(){y.offChange(this._onChange),y.offProgress(this._onProgress)}_onChange(){this.should_show=!0,this.setState(this.getState())}_onProgress(){let e=y.total,t=y.success,s=y.failure;t+s>=e&&(this.should_close=!0),this.setState({total:e,success:t,failure:s})}onSelectCurrency(e,t){let s=this.state.accept_currency,i=n.Z.clone(this.state.currencies);i[e]=t.target.checked;let a=0;for(let e in i)i[e]&&(s=e,a++);0!=a&&(2==a&&(s=v.QV0),this.setState({accept_currency:s,currencies:i}))}submit(e){if(e.preventDefault(),!this.valid)return;let{accept_currency:t}=this.state;y.accept_currency=t,y.execute(),this.forceUpdate()}show(){o.Z.block=!1,$("#listings-bulk-switch-currency-dialog").is(":visible")||$("#listings-bulk-switch-currency-dialog").modal("show")}hide(){o.Z.block=!0,$("#listings-bulk-switch-currency-dialog").modal("hide")}render(){let{accept_currency:e,currencies:t,total:s,success:l,failure:r}=this.state,n="";if(y.in_progress){let e=l+r,t=Math.floor(100*e/s);t<3&&(t=3);let a=t+"%";n=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row progress-status"},i.createElement("b",null,"Progress"),": Success: ",i.createElement("span",{className:"success"},l),", Failure: ",i.createElement("span",{className:"failure"},r),", Total: ",s),i.createElement("div",{className:"row progress"},i.createElement("div",{className:"progress-bar progress-bar-warning",role:"progressbar","aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":s,style:{width:a}},i.createElement("span",null,e))),i.createElement("div",{className:"row progress_label"},i.createElement("div",{className:"col-6 text-left"},"0"),i.createElement("div",{className:"col-6 text-right"},s)),i.createElement("div",{className:"row text"},i.createElement("b",null,"Important"),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})))}else this.valid=t[v.qBs]||t[v.jtz],n=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row checkbox"},i.createElement("span",null,(0,x._)("Accept currency"),":     "),i.createElement("label",null,i.createElement("input",{type:"checkbox",name:"accept-usd",onChange:this.onSelectCurrency.bind(this,v.qBs),checked:t[v.qBs]||!1})," USD"),"     ",i.createElement("label",null,i.createElement("input",{type:"checkbox",name:"accept-flp",onChange:this.onSelectCurrency.bind(this,v.jtz),checked:t[v.jtz]||!1})," FLP")),i.createElement("br",null),i.createElement("div",{className:"row text"},i.createElement("b",null,(0,x._)("Important")),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})),i.createElement("br",null),i.createElement("div",{className:"row text-left buttons"},i.createElement("button",{className:"btn btn-primary"+(this.valid?"":" disabled"),onClick:this.submit.bind(this)},(0,x._)("Apply All")),i.createElement("button",{className:"btn btn-outline-secondary",onClick:this.hide},(0,x._)("Cancel"))));return i.createElement(a.Dialog,{id:"listings-bulk-switch-currency-dialog",className:"fade",title:"Switch accept currencies for all selected listings",size:"lg",content:n})}}var N=s(53539),C=s(94643),S=s(39031),I=s(91345),D=s(78314),P=s(47936),L=s(330),B=s(57097);s(97261),s(17515);const A="progress";class U extends a.EventHandler{constructor(){super(),this.reset()}reset(){this._item={},this._vaults=[],this._failed_items=[],this._total=0,this._success=0,this._failure=0}emitProgress(){this.emit(A)}onProgress(e){this.on(A,e)}offProgress(e){this.off(A,e)}set item(e){this.reset(),this._item=e,this.emitChange()}get item(){return this._item}set vaults(e){a.Log.debug(e,"vaults"),this._vaults=e,this.total=this._vaults.length,this.duplicate()}get failed_items(){return this._failed_items}set total(e){this._total=e,this.emitProgress()}get total(){return this._total}increaseSuccess(){this._success++,this.emitProgress()}get success(){return this._success}increaseFailure(e){e&&this._failed_items.push(e),this._failure++,this.emitProgress()}get failure(){return this._failure}get in_progress(){return this._vaults.length>0}duplicate(){if(0==this._vaults.length)return;let e=this._vaults[0];this._vaults.splice(0,1),a.Log.debug(e,"BulkDuplicateStore: duplicate: vault");let t=n.Z.clone(this._item);delete t.id,delete t.owner,delete t.cover_photo,delete t.commission,delete t.digital_fee,delete t.expiration,delete t.comment,delete t.exchange_id,delete t.created,delete t.updated,delete t.version,t.status=v.f1I,this.postItem(t,e)}postItem(e,t){let s=this.coverPhoto(e),i=e.photo?n.Z.clone(e.photo):null;delete e.photo,r.Z.postListing(e,(e=>{E.Z.setItem(e),this.saveVault(e.id,t,(()=>{this.uploadCoverPhoto(e.id,s,(t=>{E.Z.setItem(t),this.uploadPhotos(e.id,i)}))})),this.duplicate()}),(e=>{a.Log.error(e,"BulkDuplicateStore: postListing: error"),this.increaseFailure({code:t,err:e}),this.duplicate()}))}saveVault(e,t,s){r.Z.putDigitalVault(e,t,(e=>{setTimeout((()=>{this.increaseSuccess()}),2e3),s()}),(s=>{r.Z.deleteListing(e,(()=>{E.Z.deleteItem(e),a.Log.debug("BulkDuplicateStore: deleted invalid code listing")})),a.Log.error(s,"BulkDuplicateStore: putDigitalVault: error"),this.increaseFailure({code:t,err:s})}))}coverPhoto(e){let t=null;if(e.cover_photo&&e.photo)t=e.photo[e.cover_photo];else if(e.photo)for(var s in e.photo){let i=e.photo[s];if("active"==i.status){t=i;break}}return t}uploadCoverPhoto(e,t,s){a.Log.debug(t,"BulkDuplicateStore: uploadCoverPhoto: photo"),t&&n.Z.squareCrop(t.view_url,320,(t=>{this.uploadPhoto(e,t,null,!0,((e,t)=>{s(t)}))}))}uploadPhotos(e,t){if(!t)return;let s=()=>{let i=(()=>{if(!t)return null;for(var e in t){let s=t[e];if(delete t[e],"active"==s.status&&null!=s.display_order)return s}return null})();i?this.processPhoto(e,i,(()=>{s()})):t=null};s()}processPhoto(e,t,s){a.Log.debug(t,"BulkDuplicateStore: processPhoto: photo"),n.Z.squareCrop(t.view_url,640,(i=>{this.uploadPhoto(e,i,t.display_order,!1,(e=>{s()}))}),(e=>{a.Log.error(e,"BulkDuplicateStore: squareCrop: error")}))}uploadPhoto(e,t,s,i,l){let o=n.Z.dataURItoBlob(t);r.Z.uploadPhoto(e,o,s,i,((e,t)=>{a.Log.debug(e,"BulkDuplicateStore: uploadPhoto: photo"),a.Log.debug(t,"BulkDuplicateStore: uploadPhoto: listing"),l(e,t)}),(e=>{a.Log.error(e,"BulkDuplicateStore: uploadPhoto: error")}))}}const j=new U;var T=s(58166);const R="progress";class V extends a.EventHandler{constructor(){super(),this.reset()}reset(){this._items=[],this._method="",this._adjust="-",this._unit="$",this._price=0,this._current=0,this._total=0,this._success=0,this._failure=0,this._failed_items=[],this._error=""}emitProgress(){this.emit(R)}onProgress(e){this.on(R,e)}offProgress(e){this.off(R,e)}set items(e){this._items=e,this.total=e.length}get items(){return this._items}set method(e){this._method=e}set adjust(e){this._adjust=e}set unit(e){this._unit=e}set price(e){this._price=e}set total(e){this._total=e,this.emitProgress()}get total(){return this._total}increaseSuccess(){this._success++,this.emitProgress()}get success(){return this._success}increaseFailure(e){e&&this._failed_items.push(n.Z.clone(e)),this._failure++,this.emitProgress()}get failure(){return this._failure}get failed_items(){return this._failed_items}get error(){return this._error}get in_progress(){return this._current>0}openDialog(){this.emitChange()}execute(){if(this._current>=this._total)return;let e=this._items[this._current];if(this._current++,"adjust_price_steam"==this._method){let t=()=>{this._error="Prices for some listings could not be changed due to unavailable Market prices.",this.increaseFailure(e),this.execute()};if(!e.steam_properties)return t();this.loadSteamPrice(e.steam_properties,(t=>{this.patchPrice(e,t)}),(e=>{t()}))}else this.patchPrice(e)}loadSteamPrice(e,t,s){let i=e.appid,a=e.market_hash_name||e.name;if(!i||!a)return s();T.Z.getSteamPrice(i,a,(e=>{let s=100*n.Z.lowestPrice(e.lowest_price,e.median_price);t(s)}),(e=>{s(e)}))}patchPrice(e,t){let s=t||e.price||0,i=this._price;if("adjust_price"==this._method||"adjust_price_steam"==this._method){let e="+"==this._adjust?1:-1,t="adjust_price_steam"==this._method?"%":this._unit;i="$"==t?s+e*this._price:s*(1+e*this._price/1e4)}if(!n.Z.isValidPrice(i))return this._error="Some listings could not be updated due to invalid prices.",this.increaseFailure(e),void this.execute();let l=(t,s,i)=>{let l=[{op:"replace",path:"/status",value:t}];r.Z.patchListing(e.id,l,(e=>{E.Z.setItem(e),s&&s(e)}),(e=>{a.Log.error(e,"BulkChangePriceDialog: _executePatchStatus: error"),i&&i(e)}))},o=t=>{let s=[{op:"replace",path:"/price",value:Math.round(i)}];r.Z.patchListing(e.id,s,(e=>{E.Z.setItem(e),this.increaseSuccess(),this.execute(),t&&t(e)}),(e=>{a.Log.error(e,"BulkChangePriceDialog: _executePatchPrice: error"),this.increaseFailure(),this.execute(),t&&t()}))};e.status==v.IB?l(v.f1I,(e=>{o((e=>{l(v.IB)}))}),(e=>{this.increaseFailure(),this.execute()})):o()}}const M=new V,O={draft:{ribbon:"icon_ribbon_draft.png",tools:["duplicate","edit","remove"]},ready:{ribbon:"icon_ribbon_ready.png",tools:["list","duplicate","edit","remove"]},onsale:{ribbon:"icon_ribbon_on-sale.png",tools:["comment","duplicate","bulk_duplicate","edit","delist"]},expired:{ribbon:"icon_ribbon_expired.png",tools:["list","duplicate","edit","remove"]},sold:{ribbon:"icon_ribbon_sold.png",tools:["duplicate"]}};class q extends i.Component{constructor(e,t){super(e,t)}componentDidMount(){n.Z.checkLogin()&&(S.Z.updateSoldBadge(),n.Z.setDocumentTitle((0,x._)("Listings")))}render(){if(!n.Z.isLoggedIn)return!1;let e=n.Z.parseQuery(this.props.location.search),t=this.props.match.params.tab||"all",s="sold"==t?"exchange":"listing";return i.createElement("div",{id:"listings",className:"screen container"},i.createElement("h1",null,(0,x._)("Listings")),i.createElement("div",{className:"inner-content"},i.createElement("div",{id:"sell-container"},i.createElement("button",{className:"d-none d-md-inline-block sell-btn btn btn-lg btn-primary",onClick:n.Z.startSelling},i.createElement("span",{className:"d-none d-md-inline-block"},(0,x._)("Start Selling")),i.createElement("span",{className:"d-md-none"},"Sell"))),i.createElement("ul",{className:"nav nav-tabs"},i.createElement("li",{className:"nav-item"},i.createElement(a.Link,{className:"nav-link "+("all"==t?"active":""),to:"listings"},(0,x._)("All"))),i.createElement("li",{className:"nav-item"},i.createElement(a.Link,{className:"nav-link "+("draft"==t?"active":""),to:"listings",params:{tab:"draft"}},(0,x._)("Draft"))),i.createElement("li",{className:"nav-item"},i.createElement(a.Link,{className:"nav-link "+("onsale"==t?"active":""),to:"listings",params:{tab:"onsale"}},(0,x._)("On Sale"))),i.createElement("li",{className:"nav-item"},i.createElement(a.Link,{className:"nav-link "+("sold"==t?"active":""),to:"listings",params:{tab:"sold"}},(0,x._)("Sold"),i.createElement(u.Z,{type:"sold_badge"}))),i.createElement("li",{className:"nav-item"},i.createElement(a.Link,{className:"nav-link "+("expired"==t?"active":""),to:"listings",params:{tab:"expired"}},(0,x._)("Expired"),i.createElement(u.Z,{type:"expired_badge"})))),i.createElement(F,{type:s,tab:t,query:e})),"all"==t||"onsale"==t?i.createElement(G,null):"","draft"==t||"onsale"==t?i.createElement(Q,{tab:t,query:e}):"","draft"==t||"onsale"==t?i.createElement(Z,{tab:t,query:e}):"")}}class F extends i.Component{get tabStates(){return{all:{buttons:[],sort:!0},draft:{buttons:[{action:"change_price",label:(0,x._)("Change Price")},{action:"switch_currency",label:(0,x._)("Switch Currency")},{action:"bulk_return",label:(0,x._)("Return Skins")},{action:"list",label:(0,x._)("List")},{action:"delete",label:(0,x._)("Delete")}],sort:!0},onsale:{buttons:[{action:"change_price",label:(0,x._)("Change Price")},{action:"switch_currency",label:(0,x._)("Switch Currency")},{action:"delist",label:(0,x._)("Take off Sale")}],sort:!0},expired:{buttons:[{action:"list",label:(0,x._)("List")},{action:"delete",label:(0,x._)("Delete")}],sort:!0}}}constructor(e,t){super(e,t),this.state=this.resetState()}componentDidMount(){this.loadItems(this.props)}componentDidUpdate(e,t){try{JSON.stringify(this.props)!==JSON.stringify(e)&&(this.setState(this.resetState(this.props)),this.loadItems(this.props))}catch(e){a.Log.error(e)}}resetState(e){e=e||this.props,this.type=e.type,this.tab=e.tab,this.checked_item_ids={},this.checked_all=!1;let{term:t,sort:s,limit:i}=e.query||{};return this.filters={term:t,sort:s,limit:i},{items:[],next_page:null,loaded:!1}}filterItems(e,t){this.setState(this.resetState(this.props)),this.filters=e;let s=t?{}:n.Z.pagingQuery(this.props.query||{},50);s=a.Util.merge(s,e),n.Z.transitionTo("listings",{tab:this.tab},s)}loadItems(e){"listing"==this.type?this.loadListings(e):this.loadExchanges(e)}loadListings(e){let t=n.Z.pagingQuery(e.query||{},50);t=a.Util.assign(t,{status:"draft,ready,onsale,sold",visibility:"public,unlisted",expiration:"",owner:D.Z.profile.owner}),n.Z.canSellGig&&(t.kind=[v.Iox,v.Bxu].join());let s=e=>!0;"draft"==this.tab?(t.status="draft,ready",s=e=>e.status==v.W8z||e.status==v.f1I):"onsale"==this.tab?(t.status="onsale",t.expiration="now,",t.bust_cache=!0,s=e=>e.status==v.IB):"expired"==this.tab&&(t.status="onsale",t.expiration=",now",s=e=>e.status==v.IB&&n.Z.hourPassed(e.expiration)>0);let i=(e,i)=>{let l=[],r={},n=E.Z.items;if(e.map((e=>{let t=n[e.id];t&&(t.version>e.version?e=t:E.Z.deleteItem(e.id)),s(e)&&(l.push(e),r[e.id]=!0,this.checked_all&&(this.checked_item_ids[e.id]=!0))})),1==t.page&&"expired"!=this.tab){let e="onsale"==this.tab?["onsale"]:"draft"==this.tab?["draft","ready"]:["draft","ready","onsale","sold"];E.Z.getItemsByStatus(e,D.Z.profile.owner).map((e=>{r[e.id]||(a.Log.debug(e,"active_indexing_listing"),l.unshift(e))}))}"expired"==this.tab&&(S.Z.expired_badge=l?l.length:0),this.setState({items:l,next_page:i,loaded:!0})};t.term&&n.Z.isUUID4(t.term)?r.Z.getListing(t.term,(e=>{let t=[];t.push(e),i(t,null)}),(e=>{a.Log.error(e),this.setState({items:[],next_page:null,loaded:!0})})):r.Z.searchListings(t,i,(e=>{a.Log.error(e)}))}loadExchanges(e){let t=n.Z.pagingQuery(e.query||{},50);n.Z.canSellGig&&(t.kind=[v.Iox,v.Bxu].join()),a.Log.debug(t,"loadExchanges: query");let s=(e,t)=>{let s=[];e.map((e=>{if(e.status==v.V5K&&!e.buyer_rated||e.status==v.rlS&&e.handling_status==v.Xp3){let t=e.auto_rate_after?new Date(e.auto_rate_after).getTime():null,i=(new Date).getTime();t&&i>=t&&(a.Log.debug(e,"Add exchangesto trigger rating"),s.push(e))}})),this.setState({items:e,next_page:t,loaded:!0},(()=>{this.triggerAutoRateBuyer(s)}))};t.term&&n.Z.isUUID4(t.term)?r.Z.getExchange(t.term,(e=>{let t=[];t.push(e),s(t,null)}),(e=>{a.Log.error(e),this.setState({items:[],next_page:null,loaded:!0})})):r.Z.searchExchanges(v.Efm,t,((e,t)=>{let i=e.exchanges||[];s(i,t)}),(e=>{a.Log.error(e)}))}reload(e){let t=e=>{let t=this.state.items;for(let s=0;s<=t.length;s++)if(t[s]&&t[s].id==e.id){t[s]=e,a.Log.debug(e,"Item reloaded");break}this.setState({items:t})};"listing"==this.type?r.Z.getListing(e.id,(e=>{t(e)})):r.Z.getExchange(e.id,(e=>{t(e)}))}triggerAutoRateBuyer(e){let t=e.length>0;a.Log.debug(e,"Trigger auto rate buyer");let s=()=>{if(e.length<=0)return void(t&&this.forceUpdate());let i=e.shift();r.Z.getExchange(i.id,(e=>{s()}),(e=>{s()}))};s()}loadMore(e){e.preventDefault(),this.loadItems(this.props)}onSelect(e,t){t.target.checked?this.checked_item_ids[e]=!0:(delete this.checked_item_ids[e],this.checked_all=!1),this.forceUpdate()}onOffer(e){this.setState({offeredItem:e},(()=>{N.Z.show()}))}onSelectAll(e){this.checked_all=e.target.checked,this.state.items.map((e=>{this.checked_all?this.checked_item_ids[e.id]=!0:delete this.checked_item_ids[e.id]})),this.forceUpdate()}onClickActionButton(e,t){if(0!=Object.keys(this.checked_item_ids).length)switch(e){case"list":this.listItems();break;case"delist":this.delistItems();break;case"delete":this.deleteItems();break;case"rate":this.rateBuyerItems();break;case"label":this.generateLabels();break;case"ship":this.markShipped();break;case"change_price":this.bulkChangePrice();break;case"switch_currency":this.bulkSwitchCurrency();break;case"bulk_return":this.bulkReturnSkins();break;default:a.Log.error(e,"Unknown button action")}}checkedItem(e){let t=this.state.items,s=null;for(let i in this.checked_item_ids){for(let a in t){let l=t[a];if(l.id==i){switch(s=n.Z.clone(l),e){case"list":s.status==v.f1I?(t[a].status=v.IB,t[a].expiration=""):s.status!=v.IB&&s.status!=v.Ixn||(t[a].status=v.IB,t[a].expiration="",n.Z.hourPassed(s.expiration)>0&&S.Z.decreaseBadge("expired_badge"));break;case"delist":t[a].status=v.f1I;break;case"bulk_return":s=l;break;case"delete":n.Z.checkEscrowDepositing(s.escrow_status,!1)||delete t[a];break;default:delete t[a]}this.setState({items:t});break}}delete this.checked_item_ids[i];break}return s}processAction(e,t){a.Log.debug(e,"Processing action");let s=this.checkedItem(e);s?t(s):(this.checked_all&&(this.checked_all=!1),"exchange"==this.props.type?this.setState({items:[],next_page:null},(()=>{this.loadExchanges(this.props)})):this.forceUpdate())}listItems(){let e=(e,t)=>{let s=[{op:"replace",path:"/status",value:v.IB}];r.Z.patchListing(e.id,s,(e=>{E.Z.setItem(e),t()}),(e=>{}))},t="list",s=i=>{if(i.status==v.f1I)e(i,(()=>{this.processAction(t,s)}));else if(i.status==v.IB||i.status==v.Ixn){let a=[{op:"replace",path:"/status",value:v.f1I}];r.Z.patchListing(i.id,a,(a=>{E.Z.setItem(a),e(i,(()=>{this.processAction(t,s)}))}),(e=>{}))}else n.Z.showInfoDialog((0,x._)("Draft listings cannot be listed On Sale.")),this.processAction(t,s)};this.processAction(t,s)}delistItems(){let e="delist",t=s=>{let i=[{op:"replace",path:"/status",value:v.f1I}];r.Z.patchListing(s.id,i,(s=>{E.Z.setItem(s),this.processAction(e,t)}),(e=>{}))};this.processAction(e,t)}deleteItems(){n.Z.showDialog({title:(0,x._)("Delete Listings"),message:(0,x._)("Do you want to delete all of selected listings?"),ok:{label:(0,x._)("Delete All"),callback:e=>{n.Z.hideDialog();let t=(e,t)=>{r.Z.deleteListing(e.id,(s=>{E.Z.setDeleteItem(e.id),t()}),(e=>{}))},s="delete",i=e=>{if(n.Z.checkEscrowDepositing(e.escrow_status,!1))this.processAction(s,i);else if(e.status==v.IB){let a=[{op:"replace",path:"/status",value:v.W8z}];r.Z.patchListing(e.id,a,(a=>{E.Z.setItem(a),n.Z.hourPassed(e.expiration)>0&&S.Z.decreaseBadge("expired_badge"),t(e,(()=>{this.processAction(s,i)}))}),(e=>{}))}else t(e,(()=>{this.processAction(s,i)}))};this.processAction(s,i)}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}})}rateBuyerItems(){let e="rate",t=s=>{if(s.status==v.V5K&&s.buyer_rated){a.Log.debug(s,"Rating good for exchange");let i={rate:"good",comment:"",exchange_id:s.id};r.Z.postRating(i,(s=>{this.processAction(e,t)}),(e=>{a.Log.error(e,"Error rating buyer")}))}else a.Log.debug(s.state,"Ignore rating for state"),this.processAction(e,t)};n.Z.showDialog({title:(0,x._)("Rate Buyers"),message:(0,x._)("Do you want to rate buyers Good for all of selected listings?"),ok:{label:(0,x._)("Rate All"),callback:s=>{n.Z.hideDialog(),this.processAction(e,t)}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}})}generateLabels(){let e="label";this.ship_from_address_id=n.Z.shipFromAddressId();let t=s=>{if(s.status==v.rlS&&"need_label"==s.handling_status){a.Log.debug(s,"Generate label for exchange for address id "+this.ship_from_address_id),this.processAction(e,t);let i={address_id:this.ship_from_address_id};r.Z.postExchangeLabel(s.id,i,(s=>{this.processAction(e,t)}),(e=>{a.Log.error(e,"Error generating shipping label")}))}else this.processAction(e,t)};n.Z.showDialog({title:(0,x._)("Create Shipping Label"),message:i.createElement("div",{className:"container-fluid"},i.createElement("h2",null,"Ship From Address"),i.createElement(h.Z,{type:v.mr3,address_id:this.ship_from_address_id,onSelect:(e=>{e&&e.id&&(this.ship_from_address_id=e.id)}).bind(this)})),ok:{label:(0,x._)("Create"),callback:s=>{n.Z.hideDialog(),this.ship_from_address_id&&this.processAction(e,t)}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}})}markShipped(){let e="ship",t=s=>{s.status!=v.rlS||"need_tracking"!=s.handling_status&&"shipping"!=s.handling_status?this.processAction(e,t):(a.Log.debug(s,"Mark exchanged as shipped"),r.Z.postExchangeShipped(s.id,(s=>{this.processAction(e,t)}),(e=>{a.Log.error(e,"Error marking exchange shipped")})))};this.processAction(e,t)}bulkChangePrice(){if(M.in_progress)return void n.Z.showErrorDialog((0,x._)("There is a listing is in progress of changing price. Please wait for it complete before starting a new process."));let e=this.state.items,t=[];for(let s in e){let i=e[s];this.checked_item_ids[i.id]&&i.kind==v.Iox&&t.push(i)}M.reset(),M.items=t,M.openDialog()}bulkSwitchCurrency(){if(y.in_progress)return void n.Z.showErrorDialog((0,x._)("There is a listing is in progress of switching currency. Please wait for it complete before starting a new process."));let e=this.state.items,t=[];for(let s in e){let i=e[s];this.checked_item_ids[i.id]&&i.kind==v.Iox&&t.push(i)}y.reset(),y.items=t,y.openDialog()}bulkReturnSkins(){let e=D.Z.steam_trade_url;if(!e)return;let t={},s=()=>{n.Z.showDialog({title:(0,x._)("Return items from Bot"),message:(0,x._)("We're sending trade offers to return your items. Please complete them in your Steam account. Once you successfully traded with Gameflip Steam bot, please confirm below."),ok:{label:(0,x._)("I've completed all Bot Trades"),callback:e=>{n.Z.hideDialog();for(let e in t)this.checked_item_ids[e]=!0;this.processAction(i,o)}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}})},i="bulk_return",l=!1,o=c=>{if(c.escrow_status!=v.X8_&&c.escrow_status!=v.Fgb)return void this.processAction(i,o);l||c.escrow_status!=v.X8_||(s(),l=!0);let d=()=>{var l,d;d=()=>{this.processAction(i,o)},(l=c).escrow_status==v.X8_?r.Z.postSteamEscrowReturn(l.id,e,(e=>{a.Log.debug(e,"postSteamEscrowReturn"),t[l.id]=l,l.escrow_status=v.Fgb,E.Z.setItem(l),d()}),(e=>{n.Z.showErrorDialog(e)})):l.escrow_status==v.Fgb&&r.Z.putSteamEscrowReturn(l.id,(e=>{a.Log.debug(e,"putSteamEscrowReturn"),e.status==v.vrM?l.escrow_status=v.vrM:e.status==v.Fgb?(t[l.id]=l,s()):(n.Z.showErrorDialog((0,x._)("There is a bot trade offer which has been cancelled. Please retry it again.")),l.escrow_status=v.X8_),E.Z.setItem(l),d()}),(e=>{d()}))};if(c.status==v.W8z)d();else if(c.status==v.f1I){let e=[{op:"replace",path:"/status",value:v.W8z}];r.Z.patchListing(c.id,e,(e=>{E.Z.setItem(e),c.status=v.W8z,d()}),(e=>{n.Z.showErrorDialog(e),this.processAction(i,o)}))}else this.processAction(i,o)};this.processAction(i,o)}render(){let{items:e,offeredItem:t,next_page:s,loaded:a}=this.state,{query:l}=this.props,r=!1,o="listing"==this.type&&"all"!=this.tab||l&&(l.status==v.V5K||l.status==v.rlS),c="";a&&e.length>0?c=e.map(((e,t)=>{let s=!!this.checked_item_ids[e.id];return s&&(r=!0),i.createElement(W,{type:this.type,selectable:o,item:e,onSelect:this.onSelect.bind(this,e.id),onOffer:this.onOffer.bind(this,e),checked:s,key:e.id})})):a&&(c=i.createElement("div",{className:"pager"},i.createElement("p",{className:"text-muted text-center"},"None available")));let d=n.Z.pagingQuery(l||{},50),h=i.createElement(_.Z,{to:"listings",params:{tab:this.tab},query:d,next_url:s,scrollToTop:!0}),m=this.tabStates[this.tab],u={onClickActionButton:this.onClickActionButton.bind(this),onSelectAll:this.onSelectAll.bind(this),filterItems:this.filterItems.bind(this)};return i.createElement("div",{className:"item-list"},i.createElement(g.Z,{position:"header",type:this.type,role:v.Efm,config:m,callbacks:u,checked_one:r,checked_all:this.checked_all,query:l}),c,i.createElement(g.Z,{position:"footer",type:this.type,role:v.Efm,config:m,callbacks:u,checked_one:r,checked_all:this.checked_all,query:l}),h,i.createElement(z,{onRefresh:this.reload.bind(this)}),i.createElement(N.Z,{gig:t}))}}class W extends i.Component{get toolList(){return{view:{icon:"eye",tip:(0,x._)("Quick View")},comment:{icon:"comment",tip:(0,x._)("Comments")},message:{icon:"envelope",tip:(0,x._)("Message Buyer")},duplicate:{icon:"copy",tip:(0,x._)("Create a copy in Draft")},edit:{icon:"edit",tip:(0,x._)("Edit")},remove:{icon:"trash",tip:(0,x._)("Delete")},list:{icon:"check",tip:(0,x._)("List for Sale")},delist:{icon:"power-off",tip:(0,x._)("Take off Sale")},bulk_duplicate:{icon:"bolt",tip:(0,x._)("Create multiple copies in Ready")},label:{icon:"print",tip:(0,x._)("Get Shipping Label")},rate:{icon:"thumbs-up",tip:(0,x._)("Rate Buyer")},offer:{icon:"user-tag",tip:(0,x._)("Custom Offer")}}}get exchangeStates(){let{kind:e,nft:t}=this.state.item||{},s={pending:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Processing"),color:"#ff8200"},hold_buy:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Under Review"),color:"#ff8200"},hold_challenge:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Under Review"),color:"#ff8200"},settled:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Create Shipping Label"),color:"#ff8200"},shipping:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Send Item"),color:"#ff8200"},shipping_late:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Pending Cancellation"),color:"#3E4857"},shipped:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Wait for Acceptance"),color:"#ff8200"},hold_dispute:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Under Dispute"),color:"#ff8200"},received:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Wait for Acceptance"),color:"#ff8200"},received_rated:{ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Rate Buyer to Get Paid"),color:"#ff8200"},pending_completion:{ribbon:"icon_ribbon_completed.png",text:(0,x._)("Transaction Completed"),color:"#0001C5"},complete:{ribbon:"icon_ribbon_completed.png",text:(0,x._)("Transaction Completed"),color:"#0001C5"},cancelled:{ribbon:"icon_ribbon_cancelled.png",text:(0,x._)("Transaction Cancelled"),color:"#3E4857"}};return e==v.Bxu&&(s.shipping={ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Deliver your Gig"),color:"#ff8200"}),t&&(s.shipping={ribbon:"icon_ribbon_in-progress.png",text:(0,x._)("Wait for Delivery"),color:"#ff8200"}),s}constructor(e,t){super(e,t),this.type=this.props.type,this.state=this.getState(this.props)}componentDidMount(){this.handleTooltips()}componentDidUpdate(){this.handleTooltips()}componentDidUpdate(e,t){try{JSON.stringify(this.props)!==JSON.stringify(e)&&this.setState(this.getState(this.props))}catch(e){a.Log.error(e)}}getState(e){return"listing"==this.type?this.getListingState(e):this.getExchangeState(e)}getListingState(e){let t=n.Z.clone(e.item);t.name=t.name?t.name:(0,x._)("(no name)");let s=(0,x._)(n.Z.categoryName(t.category,t.upc)),i=(0,x._)(n.Z.platformName(t.category,t.platform)),a=(0,x._)(n.Z.digitalDeliveryText(t)),l=s&&i?s+" - "+i:s||i||"",r="";if(t.digital){if(t.category==v.SkU&&t.upc){let e=[];(n.Z.categories()||[]).map(((s,i)=>{t.category==s.id&&s.platform&&(e=s.platform.items.slice(0))})),e.map(((e,i)=>{t.upc==e.id&&e.label&&(l=s+" - "+e.label)}))}else l=i&&a?i+" - "+a:i||a||"";t.escrow_status==v.vrM&&(l+=" "+(0,x._)("(returned)")),r="code"==t.digital_deliverable?t.escrow_status?"/img/app/icon_delivery_bot.png":0==t.shipping_within_days?"/img/app/icon_delivery_key_instant.png":"/img/app/icon_delivery_key.png":"/img/app/icon_delivery_transfer.png"}t.info={text:l,deliveryIcon:r,style:{}};let o=t.status;return v.IB==o&&n.Z.hourPassed(t.expiration)>0&&(o=v.Ixn),t.status=o,{item:t}}getExchangeState(e){let t=e.item,s=t.status;return v.WWs==s?t.hold_status!=v.Ev_&&t.hold_status!=v.lpQ||(s=t.hold_status):v.rlS==s?t.hold_status==v.c9c?s=v.c9c:t.shipping_fee?v.IfI==t.handling_status?s=v.PGQ:v.jJH==t.handling_status&&(s=v.Xp3):t.shipping_within_days>0&&t.shipping_late&&!t.shipped?s=v.EWw:(s=v.PGQ,v.jJH==t.handling_status&&(s=v.Xp3)):v.V5K==s&&(t.buyer_rated?s=v.Zue:t.hold_status==v.c9c&&(s=v.c9c)),v.VxZ!=s&&v.s5d!=s&&v.nmn!=s||(s=v.unP),t.state=s,{item:t}}onClickCheckbox(e){if(e.stopPropagation(),n.Z.isBrowser&&n.Z.isFirefox){let t=$(e.target),s=t.closest("a.item-detail");s.data("href",s.attr("href")).removeAttr("href"),t.on("mouseleave",(()=>{s.attr("href",s.data("href"))}))}this.props.onSelect(e)}onOffer(){let{onOffer:e}=this.props;e&&e()}onClickToolButton(e,t){t.preventDefault(),this.hideTooltip(e);let s=this.state.item;switch(e){case"duplicate":this.duplicateItem();break;case"bulk_duplicate":this.bulkDuplicate();break;case"edit":this.editItem();break;case"remove":this.deleteItem();break;case"list":this.listItem();break;case"delist":this.delistItem();break;case"label":this.getLabel();break;case"offer":n.Z.canUseCustomOffer&&this.onOffer();break;case"comment":case"view":case"message":case"rate":B.Z.showDialog(e,s)}}editItem(){let e=this.state.item;e.status==v.Ixn&&S.Z.decreaseBadge("expired_badge"),n.Z.transitionTo("sell",{id:e.id,topic:e.kind})}listItem(){let e=this.state.item,t=()=>{let t=[{op:"replace",path:"/status",value:v.IB}];r.Z.patchListing(e.id,t,(t=>{E.Z.setItem(t),e.status=v.IB,this.setState({item:e})}),(e=>{n.Z.showErrorDialog(e)}))};if(e.status==v.Ixn){let s=[{op:"replace",path:"/status",value:v.f1I}];r.Z.patchListing(e.id,s,(s=>{E.Z.setItem(s),e.status=v.f1I,this.setState({item:e}),t(),S.Z.decreaseBadge("expired_badge")}),(e=>{n.Z.showErrorDialog(e)}))}else t()}duplicateItem(){let e=e=>{e.status=v.W8z,delete e.id,delete e.owner,delete e.commission,delete e.digital_fee,delete e.expiration,delete e.comment,delete e.exchange_id,delete e.created,delete e.updated,delete e.version,e.kind==v.Bxu?(L.ZP.reset(),L.ZP.postGig(e)):(P.Z.reset(),P.Z.postItem(e))};a.Log.debug(this.props.item,"duplicateItem: source item");let t=n.Z.clone(this.props.item);if(t.cache_expire||"exchange"==this.type){let s="exchange"==this.type?t.listing_id:t.id;r.Z.getListing(s,(t=>{t.escrow_status||t.category==v.xmu||t.kind==v.n$X?n.Z.showErrorDialog((0,x._)("This item cannot be duplicated at this moment.")):e(t)}),(e=>{}))}else e(t)}bulkDuplicate(){if(j.in_progress)return void n.Z.showErrorDialog((0,x._)("There is a listing is in progress of duplicating. Please wait for it complete before starting a new process."));let e=n.Z.clone(this.props.item);e.cache_expire?r.Z.getListing(e.id,(e=>{j.item=e}),(e=>{})):j.item=e}delistItem(){let e=this.state.item,t=[{op:"replace",path:"/status",value:v.f1I}];r.Z.patchListing(e.id,t,(t=>{E.Z.setItem(t),e.status=v.f1I,this.setState({item:e})}),(e=>{n.Z.showErrorDialog(e)}))}deleteItem(){let e=this.state.item;n.Z.checkEscrowDepositing(e.escrow_status,!0)||n.Z.showDialog({title:(0,x._)("Delete Listing"),message:(0,x._)("Do you want to delete this listing?"),ok:{label:(0,x._)("Delete"),callback:t=>{let s=()=>{r.Z.deleteListing(e.id,(t=>{E.Z.setDeleteItem(e.id),n.Z.hideDialog(),this.setState({item:null})}),(e=>{n.Z.hideDialog()}))};if(e.status==v.IB||e.status==v.Ixn){let t=[{op:"replace",path:"/status",value:v.W8z}];r.Z.patchListing(e.id,t,(t=>{E.Z.setItem(t),e.status=v.W8z,this.setState({item:e}),s(),e.status==v.Ixn&&S.Z.decreaseBadge("expired_badge")}),(e=>{n.Z.hideDialog()}))}else s()}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}})}getLabel(){let e=this.props.item;e&&e.id&&(e.label_pdf_url?window.open(e.label_pdf_url,"_blank"):r.Z.getExchangeLabel(e.id,(t=>{t.label_pdf_url&&(e.label_pdf_url=t.label_pdf_url,window.open(t.label_pdf_url,"_blank"))}),(e=>{n.Z.showErrorDialog((0,x._)("Cannot get shipping label"))})))}handleTooltips(){if(n.Z.isBrowser&&this.state.item&&this.state.item.id){let e=$(".item-id-"+this.state.item.id+" .tool-btn");e.length>0&&e.tooltip()}}hideTooltip(e){if(n.Z.isBrowser&&this.state.item&&this.state.item.id&&e){let t=$(".item-id-"+this.state.item.id+" .tool-btn.tool-"+e);t.length>0&&t.tooltip("hide")}}render(){let e=this.state.item;if(!e)return!1;let t="";if("listing"==this.type){let s=O[e.status];if(!s)return!1;e.ribbon="/img/app/"+s.ribbon,"unlisted"==e.visibility&&"onsale"==e.status&&(e.ribbon="/img/app/icon_ribbon_unlisted.png"),e.tools=s.tools.slice(0),e.status==v.IB&&e.kind==v.Bxu&&e.tools.unshift("offer");let a=(0,x._)("just now");e.date=(0,x._)("Created")+" "+(n.Z.timePassed(e.created)||a),e.status==v.W8z||e.status==v.Ixn?(e.link_to="sell",e.link_params={id:e.id,topic:e.kind}):e.status==v.A9h?(e.link_to="exchange_seller",e.link_params={id:e.exchange_id}):(e.link_to=e.kind==v.Bxu?"gig":"item",e.link_params={name:n.Z.slug(e.name),id:e.id}),n.Z.flpEnabled&&e.status!=v.A9h&&e.digital&&(e.accept_currency==v.jtz||e.accept_currency==v.QV0)&&(t=i.createElement("span",{className:"ml-2"},"(",i.createElement(p.Z,{money:e.bn_price||e.price,currency:v.jtz,flpAsUSD:!1,leadingText:"≈ "}),")"))}else{let t=this.exchangeStates[e.state]||this.exchangeStates[v.rlS];if(!t)return!1;let s=e.state==v.PGQ&&e.escrow_status;if(e.ribbon="/img/app/"+t.ribbon,e.info={text:s?(0,x._)("Wait for Acceptance"):t.text,style:{color:t.color}},e.tools=["view","message","duplicate"],e.date=(0,x._)("Sold")+" "+n.Z.timePassed(e.created),e.link_to="exchange_seller",e.link_params={id:e.id},e.kind!=v.Iox||e.digital||-1==[v.PGQ,v.Xp3].indexOf(e.state)||e.tools.unshift("label"),e.status==v.I2W&&!e.seller_rated&&!e.escrow_status)try{let t=1728e6,s=e.rate_by?new Date(e.rate_by):new Date(new Date(e.completed).getTime()+t);new Date<s&&e.tools.unshift("rate")}catch(e){a.Log.debug(e)}}let s=e.tools.map((t=>{let s=this.toolList[t];if("duplicate"==t&&(e.escrow_status||e.steam_properties))return!1;if("bulk_duplicate"==t&&(!e.digital||e.category==v.SkU||"code"!=e.digital_deliverable||0!=e.shipping_within_days))return!1;let a="comment"==t&&e.comment?i.createElement("span",{className:"comment-count float-left"},e.comment):"",l="message"==t&&e.message?i.createElement("span",{className:"message-count float-left"},e.message):"";return i.createElement("button",{key:t,className:"btn btn-outline-secondary tool-btn tool-"+t,title:s.tip,onClick:this.onClickToolButton.bind(this,t)},a,l,i.createElement("span",{className:"fa fa-"+s.icon,"aria-hidden":"true"}))})),r=e.info.deliveryIcon?i.createElement("img",{className:"img-digital-delivery",src:e.info.deliveryIcon}):"",o=this.props.selectable||!1,c=e.kind===v.n$X||e.category==v.xmu&&"gameflip"==e.platform?"/img/app/icon_category_orange_blockchain.png":l.Z.apiEndpoint+"listing/"+e.listing_id+"/photo/cover_photo";return i.createElement("div",{className:"row item-detail item-id-"+e.id},i.createElement("div",{className:"d-none d-md-inline-block col-md-1 select text-center"},o?i.createElement("input",{type:"checkbox",onClick:this.onClickCheckbox.bind(this),checked:this.props.checked}):""),i.createElement("div",{className:"col-3 col-md-1 photo"},i.createElement(a.Link,{to:e.link_to,params:e.link_params},i.createElement("div",{className:"square-responsive"},i.createElement(m.Z,{className:"img-fluid "+(e.category==v.SkU?"bg_3d":"bg_2d"),item:e,placeholder:c,dim:320}),i.createElement("img",{className:"icon-ribbon",src:e.ribbon})))),i.createElement("div",{className:"col-9 col-md-6 info"},i.createElement("div",{className:"row"},i.createElement("div",{className:"col-12"},i.createElement("h4",{className:"name"},i.createElement(a.Link,{to:e.link_to,params:e.link_params},e.name),e.escrow_status==v.IZR?i.createElement("span",{className:"text-warning"},"   (On Hold)"):""))),i.createElement("div",{className:"row"},e.kind==v.Iox?i.createElement("div",{className:"col-12",style:e.info.style},e.info.text," ",r):""),i.createElement("div",{className:"row"},i.createElement("div",{className:"col-12 col-md-5"},i.createElement(p.Z,{className:"h5 formatted-money",money:e.bn_price||e.price,currency:e.accept_currency}),t),"exchange"==this.type?i.createElement("div",{className:"col-12 col-md-7"},i.createElement(X,{id:e.buyer})):"")),i.createElement("div",{className:"col-12 col-md-4 buttons"},i.createElement("div",{className:"row no-gutters"},i.createElement("div",{className:"col-5"},i.createElement("p",{className:"d-md-none date text-muted"},i.createElement("small",null,e.date))),i.createElement("div",{className:"col-7 col-md-12 text-right"},s,i.createElement("div",{className:"d-none d-md-block date text-muted"},i.createElement("small",null,e.date))))))}}class z extends i.Component{constructor(e,t){super(e,t),this.state={tool:"",item:null},this._onDialog=this._onDialog.bind(this),this.should_show=!1}componentDidUpdate(){this.should_show&&(this.should_show=!1,this.show())}componentWillUnmount(){B.Z.offShowDialog(this._onDialog)}componentDidMount(){B.Z.onShowDialog(this._onDialog)}_onDialog(e,t){this.should_show=!0,this.setState({tool:e,item:t})}rate(e){let{tool:t,item:s}=this.state;"rate"==t&&s&&s.id&&(e.exchange_id=s.id,r.Z.postRating(e,(e=>{this.props.onRefresh&&this.props.onRefresh(s),this.hide()}),(e=>{this.hide(),n.Z.showErrorDialog(e)})))}show(){$("#listings-quickview-dialog").is(":visible")||$("#listings-quickview-dialog").modal("show")}hide(){$("#listings-quickview-dialog").modal("hide")}render(){let{tool:e,item:t}=this.state;switch(e){case"view":return this.renderExchange(t);case"message":return this.renderMessages(t);case"rate":return this.renderRating(t);case"comment":return this.renderComments(t)}return!1}renderExchange(e){let t=e?"Order: "+e.name:"Order",s=e?i.createElement(I.default,{exchange_id:e.id,quickview:!0}):"";return i.createElement(a.Dialog,{id:"listings-quickview-dialog",className:"fade",title:t,size:"xl",content:s})}renderMessages(e){let t=(0,x._)("Messages")+(e?": "+e.name:""),s="";if(e){let t=[v.WWs,v.s5d,v.nmn,v.h_V,v.I2W,v.unP,v.VxZ].indexOf(e.status)>=0;s=i.createElement(d.Z,{exchange_id:e.id,readonly:t,quickview:!0})}return i.createElement(a.Dialog,{id:"listings-quickview-dialog",className:"fade",title:t,content:i.createElement("div",{className:"container-fluid"},s)})}renderRating(e){let t=i.createElement("span",null,(0,x._)("Rate Buyer"),": ",e.name),s=(0,x._)("My experience with this Buyer was");return i.createElement(a.Dialog,{id:"listings-quickview-dialog",className:"fade",title:t,size:"med",content:i.createElement("div",{className:"container-fluid"},i.createElement(f.Z,{heading:s,onPostRating:this.rate.bind(this)}))})}renderComments(e){let t=e?(0,x._)("Comments in Listing")+": "+e.name:(0,x._)("Comments");return i.createElement(a.Dialog,{id:"listings-quickview-dialog",className:"fade",title:t,content:i.createElement("div",{className:"container-fluid"},e?i.createElement(c.Z,{className:"col-12",id:e.id,status:e.status,owner_id:e.owner}):"")})}}class G extends i.Component{getState(){return{item:{},vaults:"",total:0,success:0,failure:0,failed_items:null,dismissable:!1}}constructor(e,t){super(e,t),this.state=this.getState(),this._onChange=this._onChange.bind(this),this._onProgress=this._onProgress.bind(this),this.should_show=!1,this.should_close=!1}componentDidMount(){j.onChange(this._onChange),j.onProgress(this._onProgress)}componentDidUpdate(){this.should_show?(this.should_show=!1,this.show()):this.should_close&&(this.should_close=!1,this.hide(),this.setState(this.getState()),n.Z.transitionTo("listings"))}componentWillUnmount(){j.offChange(this._onChange),j.offProgress(this._onProgress)}_onChange(){this.should_show=!0,this.setState({item:j.item})}_onProgress(){let e=j.total,t=j.success,s=j.failure,i=j.failed_items,a=this.state.dismissable;t+s>=e&&(a=!0),this.setState({total:e,success:t,failure:s,failed_items:i,dismissable:a})}onChangeVaults(e){this.setState({vaults:e.target.value})}submit(e){e.preventDefault();let t=this.state.vaults.trim();t&&(t=t.split("\n").map((e=>e.trim())).filter((e=>e)),n.Z.showDialog({title:(0,x._)("Confirmation"),message:(0,x._)("This action will create {x} listings in Ready state. Do you want to proceed?",{x:t.length}),ok:{label:(0,x._)("Confirm"),callback:e=>{n.Z.hideDialog(),j.vaults=t}},cancel:{label:(0,x._)("Cancel"),callback:e=>{n.Z.hideDialog()}}}))}show(){o.Z.block=!1,$("#listings-bulk-duplicate-dialog").is(":visible")||$("#listings-bulk-duplicate-dialog").modal("show")}hide(){o.Z.block=!0,$("#listings-bulk-duplicate-dialog").modal("hide")}finish(){this.should_close=!0,this.setState({dismissable:!1})}render(){let e=this.state.item;if(!e.id)return!1;let t=i.createElement("span",null,"Create multiple copies of ",i.createElement("b",null,e.name)),s=this.state.total,l="";if(0!=s||j.in_progress){let{success:e,failure:t,failed_items:a,dismissable:r}=this.state,n=e+t,o=Math.floor(100*n/s);o<3&&(o=3);let c=o+"%",d="";a&&a.length&&(d=a.map(((e,t)=>{let s=e.err?e.err.message:"";return i.createElement("li",{key:t},i.createElement("b",null,e.code),": ",i.createElement("i",{className:"text-danger"},s))}))),l=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row progress-status"},i.createElement("b",null,(0,x._)("PROGRESS")),"    ",(0,x._)("Success"),": ",i.createElement("span",{className:"success"},e),", ",(0,x._)("Failure"),": ",i.createElement("span",{className:"failure"},t),", ",(0,x._)("Total"),": ",s),i.createElement("div",{className:"row progress"},i.createElement("div",{className:"progress-bar progress-bar-warning",role:"progressbar","aria-valuenow":o,"aria-valuemin":"0","aria-valuemax":s,style:{width:c}},i.createElement("span",null,n))),i.createElement("div",{className:"row progress_label"},i.createElement("div",{className:"col-6 text-left"},"0"),i.createElement("div",{className:"col-6 text-right"},s)),r?"":i.createElement("div",{className:"row text"},i.createElement("b",null,(0,x._)("Important")),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})),d?i.createElement("div",null,i.createElement("hr",null),i.createElement("b",{className:"text-danger"},(0,x._)("FAILURE")),i.createElement("ul",null,d),i.createElement("hr",null)):"",r?i.createElement("div",{className:"row text-left buttons"},i.createElement("button",{className:"btn btn-primary",onClick:this.finish.bind(this)},(0,x._)("Finish"))):"")}else{let e=this.state.vaults;l=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row text"},(0,x._)("Paste your digital keys or codes below. <b>One line per listing</b>, maximum 50 keys or codes.")),i.createElement("div",{className:"row"},i.createElement("textarea",{className:"form-control",value:e,onChange:this.onChangeVaults.bind(this),placeholder:(0,x._)("Paste your digital keys or codes below. One line per listing, maximum 50 keys or codes."),rows:"10"})),i.createElement("div",{className:"row text"},i.createElement("b",null,(0,x._)("Important")),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})),i.createElement("div",{className:"row text-left buttons"},i.createElement("button",{className:"btn btn-primary",onClick:this.submit.bind(this)},"Submit"),i.createElement("button",{className:"btn btn-outline-secondary",onClick:this.hide},"Cancel")))}return i.createElement(a.Dialog,{id:"listings-bulk-duplicate-dialog",className:"fade",title:t,size:"lg",content:l})}}class Q extends i.Component{getState(){return{method:"",price:"",adjust:"-",unit:"%",total:0,success:0,failure:0}}constructor(e,t){super(e,t),this.state=this.getState(),this._onChange=this._onChange.bind(this),this._onProgress=this._onProgress.bind(this),this.should_show=!1,this.should_close=!1}componentDidMount(){M.onChange(this._onChange),M.onProgress(this._onProgress)}componentDidUpdate(){this.should_show?(this.should_show=!1,this.show()):this.should_close&&(this.should_close=!1,setTimeout((()=>{this.hide();let e=n.Z.pagingQuery(this.props.query||{},50);n.Z.transitionTo("listings",{tab:this.props.tab},e);let t=M.error,s=M.failed_items;if(t){let e=n.Z.notEmpty(s)?i.createElement(b.Z,{items:s,nolink:!0,view:"list"}):"",a=i.createElement("div",null,i.createElement("div",{className:"alert alert-danger"},t),e);setTimeout((()=>{n.Z.showDialog({title:"There is an error",message:a,ok:{label:"OK",callback:e=>{n.Z.hideDialog()}}})}),1e3)}M.reset()}),1e3))}componentWillUnmount(){M.offChange(this._onChange),M.offProgress(this._onProgress)}_onChange(){this.should_show=!0;let e=this.getState();this.setState(e)}_onProgress(){let e=M.total,t=M.success,s=M.failure;t+s>=e&&(this.should_close=!0),this.setState({total:e,success:t,failure:s})}selectMethod(e){this.setState({method:e})}onChangePrice(e){let t=n.Z.parsePrice(e.target.value);!1!==t&&this.setState({price:t})}onChangeAdjust(e){this.setState({adjust:e})}onChangeUnit(e){this.setState({unit:e})}submit(e){if(e.preventDefault(),!this.valid)return;let{method:t,adjust:s,unit:i,price:a}=this.state;M.method=t,M.adjust=s,M.unit=i,M.price=a,M.execute(),this.forceUpdate()}show(){o.Z.block=!1,$("#listings-bulk-change-price-dialog").is(":visible")||$("#listings-bulk-change-price-dialog").modal("show")}hide(){o.Z.block=!0,$("#listings-bulk-change-price-dialog").modal("hide")}render(){let{method:e,price:t,adjust:s,unit:l,total:r,success:o,failure:c}=this.state,d="adjust_price"==e||"adjust_price_steam"==e?t:n.Z.isValidPrice(t);t=t?parseFloat(t/100).toFixed(2):"",this.valid=d;let h="";if(M.in_progress){let e=o+c,t=Math.floor(100*e/r);t<3&&(t=3);let s=t+"%";h=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row progress-status"},i.createElement("b",null,"Progress"),": Success: ",i.createElement("span",{className:"success"},o),", Failure: ",i.createElement("span",{className:"failure"},c),", Total: ",r),i.createElement("div",{className:"row progress"},i.createElement("div",{className:"progress-bar progress-bar-warning",role:"progressbar","aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":r,style:{width:s}},i.createElement("span",null,e))),i.createElement("div",{className:"row progress_label"},i.createElement("div",{className:"col-6 text-left"},"0"),i.createElement("div",{className:"col-6 text-right"},r)),i.createElement("div",{className:"row text"},i.createElement("b",null,"Important"),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})))}else h=i.createElement("div",{className:"container-fluid"},i.createElement("div",{className:"row text"},"Select an option below to proceed:"),i.createElement("br",null),i.createElement("div",{className:"row"},i.createElement("div",{className:"col-2 col-md-1 text-right"},i.createElement("input",{className:"pointer",type:"radio",name:"method",value:"new_price",onClick:this.selectMethod.bind(this,"new_price"),checked:"new_price"==e})),i.createElement("div",{className:"col-10 col-md-11 pointer",onClick:this.selectMethod.bind(this,"new_price")},i.createElement("p",null,i.createElement("b",null,"Set new price")))),"new_price"==e?i.createElement("div",{className:"row"},i.createElement("div",{className:"col-2 col-md-1"}),i.createElement("div",{className:"col-10 col-md-3 form-group edit-item-price"+(d?"":" has-error")},i.createElement("div",{className:"input-group"},i.createElement("span",{className:"input-group-prepend"},"$"),i.createElement("input",{className:"form-control form-control-sm text-right",type:"text",placeholder:"New Price",value:t,onChange:this.onChangePrice.bind(this)}),i.createElement("span",{className:"input-group-prepend"},"USD")),d?"":i.createElement("small",{className:"text-danger"},(0,x._)("Valid price range"),": $",v.CJR/100," - $",v.n3Z/100))):"",i.createElement("div",{className:"row"},i.createElement("div",{className:"col-2 col-md-1 text-right"},i.createElement("input",{className:"pointer",type:"radio",name:"method",value:"adjust_price",onClick:this.selectMethod.bind(this,"adjust_price"),checked:"adjust_price"==e})),i.createElement("div",{className:"col-10 col-md-11 pointer",onClick:this.selectMethod.bind(this,"adjust_price")},i.createElement("p",null,i.createElement("b",null,"Reduce or Increase price from current price")))),"adjust_price"==e?i.createElement(J,{adjust:s,price:t,unit:l,onChangeAdjust:this.onChangeAdjust.bind(this),onChangePrice:this.onChangePrice.bind(this),onChangeUnit:this.onChangeUnit.bind(this)}):"",i.createElement("div",{className:"row"},i.createElement("div",{className:"col-2 col-md-1 text-right"},i.createElement("input",{className:"pointer",type:"radio",name:"method",value:"adjust_price_steam",onClick:this.selectMethod.bind(this,"adjust_price_steam"),checked:"adjust_price_steam"==e})),i.createElement("div",{className:"col-10 col-md-11 pointer",onClick:this.selectMethod.bind(this,"adjust_price_steam")},i.createElement("p",null,i.createElement("b",null,"Reduce or Increase price from suggested Market price (only if applicable)")))),"adjust_price_steam"==e?i.createElement(J,{adjust:s,price:t,fixed_unit:"%",onChangeAdjust:this.onChangeAdjust.bind(this),onChangePrice:this.onChangePrice.bind(this)}):"",i.createElement("br",null),i.createElement("div",{className:"row text"},i.createElement("b",null,(0,x._)("Important")),": ",(0,x._)("It takes several minutes to complete, so please do <u>not</u> close the browser or navigate elsewhere.",{__html:!0})),i.createElement("br",null),i.createElement("div",{className:"row text-left buttons"},i.createElement("button",{className:"btn btn-primary"+(this.valid?"":" disabled"),onClick:this.submit.bind(this)},"Apply All"),i.createElement("button",{className:"btn btn-outline-secondary",onClick:this.hide},"Cancel")));return i.createElement(a.Dialog,{id:"listings-bulk-change-price-dialog",className:"fade",title:"Change prices for all selected listings",size:"lg",content:h})}}class J extends i.Component{onChangeAdjust(e,t){this.props.onChangeAdjust(e)}onChangeUnit(e,t){this.props.onChangeUnit(e)}render(){let{adjust:e,price:t,unit:s,fixed_unit:a,onChangePrice:l}=this.props;return i.createElement("div",{className:"row"},i.createElement("div",{className:"col-2 col-md-1"}),i.createElement("div",{className:"col-10 col-md-4"},i.createElement("div",{className:"input-group"},i.createElement("div",{className:"input-group-append"},i.createElement("button",{className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i.createElement("span",{className:"text-primary"},e,"  "),i.createElement("span",{className:"caret"})),i.createElement("ul",{className:"dropdown-menu pointer scrollable-menu",role:"menu"},i.createElement("li",null,i.createElement("a",{className:"dropdown-item",onClick:this.onChangeAdjust.bind(this,"-")},i.createElement("b",null,"-")," Decrease")),i.createElement("li",null,i.createElement("a",{className:"dropdown-item",onClick:this.onChangeAdjust.bind(this,"+")},i.createElement("b",null,"+")," Increase")))),i.createElement("input",{className:"form-control text-right",type:"text",placeholder:"$"==s?"-/+ Amount":"-/+ Percentage",value:t||"",onChange:l}),a?i.createElement("div",{className:"input-group-prepend"},a):i.createElement("div",{className:"input-group-append"},i.createElement("button",{className:"btn btn-clear dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i.createElement("span",{className:"text-primary"},s,"  "),i.createElement("span",{className:"caret"})),i.createElement("ul",{className:"dropdown-menu pointer scrollable-menu",role:"menu"},i.createElement("li",null,i.createElement("a",{className:"dropdown-item",onClick:this.onChangeUnit.bind(this,"%")},i.createElement("b",null,"%")," ",(0,x._)("by percentage"))),i.createElement("li",null,i.createElement("a",{className:"dropdown-item",onClick:this.onChangeUnit.bind(this,"$")},i.createElement("b",null,"$")," ",(0,x._)("by amount"))))))))}}class X extends i.Component{constructor(e,t){super(e,t),this.state={profile:{}}}componentDidMount(){this.props.id&&!this.props.profile&&this.loadProfile(this.props.id)}componentDidUpdate(e,t){this.props.id&&this.props.id!==e.id&&!this.props.profile&&this.loadProfile(this.props.id)}loadProfile(e){r.Z.getProfile(e,(e=>{this.setState({profile:e})}),(e=>{}))}render(){let e=this.props.profile||this.state.profile,t=e.owner||this.props.id;return i.createElement("div",{className:"row mb-1"},i.createElement("div",{className:"col-12"},i.createElement("span",null,(0,x._)("Bought by")," "),i.createElement(C.Z,{className:"d-none d-md-inline-block",profile:e}),i.createElement(a.Link,{to:"profile",params:{id:t,name:n.Z.slug(e.display_name)}},i.createElement("span",{className:"overflow-hidden"},e.display_name))))}}}}]);